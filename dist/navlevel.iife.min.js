(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".navlevel-nav[data-v-2bcd1869]{display:flex;flex-direction:row;flex-wrap:wrap;gap:2px 1em}.navlevel-radio-group[data-v-2bcd1869]{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;padding:2px}")),document.head.appendChild(e)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();

/// <reference types="types-mediawiki" />
/// <reference types="types-mediawiki-api" />
mw.loader.using(["vue", "@wikimedia/codex", "ext.gadget.HanAssist"], function(require) {
  const vueModule = require("vue");
  const codexModule = require("@wikimedia/codex");
  
  
  const Vue = vueModule;
  const Codex = codexModule;
  
  // 原始代码
  (function(){"use strict";const Y="rswiki:NavLevel-data",K="rswiki:NavLevel-levels",q="rswiki:NavLevel-expiry",G="rswiki:NavLevel-options",ne="https://rs.miraheze.org/";async function P(){const e=await new mw.Api().get({action:"cargoquery",formatversion:2,tables:"Level",fields:"Level.name_zh = name, Level.num = num, Level._pageName = page, Level.type = type, Level.stars = stars, Level.first_came_version = inVer, Level.removed_version = remVer, Level.restored_version = resVer",where:"Level.stars IS NOT NULL AND(Level.type = '官方' OR Level.type = '共创') AND (Level.removed_version IS NULL OR Level.restored_version IS NOT NULL)",limit:500});if(!e.cargoquery)return null;const a=e.cargoquery.map(o=>({...o.title,num:Number(o.title.num),stars:Number(o.title.stars)}));return a.length<210?null:a}async function ae(){const e=localStorage.getItem(Y);let a;try{if(!e)throw new Error("No data");a=JSON.parse(e)}catch{}const o=localStorage.getItem(q);if(o&&Number(o)&&Number(o)<Date.now()){console.log("Expired, fetching new data");const d=await P();return d?(localStorage.setItem(Y,JSON.stringify(d)),localStorage.setItem(q,String(Date.now()+432e5)),d):a}return a||(a=await P(),a&&(localStorage.setItem(Y,JSON.stringify(a)),localStorage.setItem(q,String(Date.now()+432e5))),a)}async function oe(){let e=mw.storage.getObject(K);if(e)return e;const a=await fetch(ne+"wiki/Module:NavLevel/levels?action=raw");if(!a.ok)return null;const d=(await a.text()).replace(/^return\s+/,"").replace(/\{/g,"[").replace(/\}/g,"]").replace(/\-\-.*?\n/g,"");try{e=JSON.parse(d)}catch{return null}return mw.storage.setObject(K,e,43200),e}function le(e){mw.storage.setObject(G,e)}function re(){const e=mw.storage.getObject(G);return e||null}const Q=Object.freeze(Object.defineProperty({__proto__:null,fetchData:P,getData:ae,getValidLevels:oe,loadOptionsFromStorage:re,saveOptionsToStorage:le},Symbol.toStringTag,{value:"Module"}));let u;({convByVar:u}=require("ext.gadget.HanAssist"));const O=new Map;function se(e){for(const a of e){const o=a.textContent.trim(),d=decodeURI(a.href.split("wiki/")[1]);O.set(d,o),O.set(o,o),O.set(d.replace(/_/g," "),o),O.set(o.replace(/_/g," "),o)}}function ie(e){return O.get(e)||e}function ue(e){return u({hans:"共创",hant:"共創"})}const ce=Vue.defineComponent,ve=Vue.renderList,de=Vue.Fragment,U=Vue.openBlock,F=Vue.createElementBlock,pe=Vue.toDisplayString,me=Vue.createElementVNode,ge={class:"hlist"},fe=["href","title"],J=ce({__name:"HList",props:{levels:{}},setup(e){console.log(u);function a(o){return ie(o.page)}return(o,d)=>(U(),F("ul",ge,[(U(!0),F(de,null,ve(e.levels,r=>(U(),F("li",null,[me("a",{href:`/wiki/${encodeURI(r.page)}`,title:`${r.type==="官方"?"Lv.":"Co."}${r.num} ${a(r)} ${"★".repeat(r.stars)}`},pe(a(r)),9,fe)]))),256))]))}}),_e=Vue.defineComponent,y=Vue.unref,h=Vue.toDisplayString,m=Vue.createElementVNode,V=Vue.renderList,f=Vue.Fragment,c=Vue.openBlock,v=Vue.createElementBlock,L=Vue.createTextVNode,D=Vue.withCtx,N=Vue.createVNode,R=Vue.createCommentVNode,he={class:"navbox-cell navbox-sole-row navbox-title stikitable-cell"},xe={class:"navbox-title-content"},ye={href:"/wiki/关卡"},Se={class:"navbox-above navbox-cell navbox-sole-row"},be={class:"navbox-above navbox-cell navbox-sole-row navlevel-nav"},Ee={class:"navlevel-radio-group"},Ve={class:"navlevel-radio-group"},Le={class:"navlevel-radio-group"},Ne={class:"navlevel-radio-group"},we={key:0,class:"navbox-list navbox-sole-row"},Oe={class:"navbox-group navbox-cell"},ke={class:"navbox-group-flex-inner"},Ce={class:"navbox-list navbox-cell"},Ie={key:0,class:"navbox-group navbox-cell"},$e={class:"navbox-group-flex-inner"},De={key:1,class:"navbox navbox-list navbox-cell navbox-level-1 mobileplainbox"},Re={key:0,class:"navbox-group navbox-cell"},Ae={class:"navbox-group-flex-inner"},Te={key:1,class:"navbox-list navbox-cell"},A=Codex.CdxRadio,Me=Vue.onMounted,w=Vue.ref,W=((e,a)=>{const o=e.__vccOpts||e;for(const[d,r]of a)o[d]=r;return o})(_e({__name:"Main",props:{data:{},levels:{},preservedElements:{},titleElement:{}},setup(e){const a=Q,{saveOptionsToStorage:o,loadOptionsFromStorage:d}=a,r=e,_={type:u({hans:"类型",hant:"類型"}),era:u({hans:"时期",hant:"時期"}),stars:u({hans:"星数",hant:"星數"}),none:u({hans:"无",hant:"無"})},k={num:u({hans:"编号",hant:"編號"}),name:u({hans:"名称",hant:"名稱"}),stars:u({hans:"星数",hant:"星數"}),default:u({hans:"默认",hant:"預設"})},S={asc:"升序",desc:"降序"},p=d();function C(t){return t in _}function X(t){return t in k}function j(t){return t in S}const g=w(p?.grouping1&&C(p.grouping1)?p.grouping1:"type"),x=w(p?.grouping2&&C(p.grouping2)?p.grouping2:"stars"),T=w(p?.sorting&&X(p.sorting)?p.sorting:"default"),M=w(p?.direction&&j(p.direction)?p.direction:"asc"),B=w(null),b=w({});Me(()=>{if(B.value&&r.preservedElements?.length){r.preservedElements[0].parentElement.remove();let n=B.value;r.preservedElements.forEach(l=>{l&&n.parentNode&&(n.parentNode.insertBefore(l,n.nextSibling),n=l)}),B.value.remove()}I()});function ee(t,n){switch(T.value){case"num":return t.type===n.type?t.num-n.num:t.type==="官方"?-1:1;case"name":return t.name.localeCompare(n.name);case"stars":return t.stars-n.stars||r.levels.indexOf(t.page)-r.levels.indexOf(n.page);case"default":return r.levels.indexOf(t.page)-r.levels.indexOf(n.page);default:return 0}}function te(t,n){return M.value==="asc"?ee(t,n):ee(n,t)}function Be(t,n){switch(n){case"era":return[{group:"辣椒",list:t.filter(i=>i.type==="官方"&&i.num<=7)},{group:u({hans:"猎豹",hant:"獵豹"}),list:t.filter(i=>i.type==="官方"&&i.num>7&&i.num<=94)},{group:u({hans:"米麦",hant:"米麥"}),list:t.filter(i=>i.type==="共创"||i.type==="官方"&&i.num>94)}];case"type":const l=[];return l.push({group:"官方",list:t.filter(i=>i.type==="官方")}),l.push({group:ue(),list:t.filter(i=>i.type==="共创")}),l;case"stars":const s=new Set;return t.forEach(i=>s.add(i.stars)),Array.from(s).sort((i,z)=>i-z).map(i=>({group:i+" 星",list:t.filter(z=>z.stars===i)}));default:return t}}function H(t,n){return Be(t,n).map(l=>(l.list=l.list.sort(te),l))}function I(){if(g.value===x.value&&x.value!=="none"&&(x.value=g.value==="stars"?"type":"stars"),g.value==="none"&&(x.value="none"),o({grouping1:g.value,grouping2:x.value,sorting:T.value,direction:M.value}),g.value==="none"){b.value=[...r.data].sort(te);return}else x.value==="none"?(b.value=H(r.data,g.value),console.log(b.value)):(b.value=H(r.data,g.value).map(t=>(t.list=H(t.list,x.value),t)),console.log(b.value))}return(t,n)=>(c(),v(f,null,[m("div",he,[m("span",xe,[m("a",ye,h(y(u)({hans:"关卡",hant:"關卡"})),1)])]),m("div",Se,h(y(u)({hans:`本智能排序为实验性功能。当前获取到 ${e.data.length} 个关卡的数据。`,hant:`本智能排序為實驗性功能。當前獲取到 ${e.data.length} 個關卡的數據。`})),1),m("div",be,[m("div",Ee,[L(h(y(u)({hans:"一级分组：",hant:"一級分組："}))+" ",1),(c(),v(f,null,V(_,(l,s)=>N(y(A),{"model-value":g.value,"onUpdate:modelValue":[n[0]||(n[0]=E=>g.value=E),I],"input-value":s,name:"grouping1",inline:!0},{default:D(()=>[L(h(_[s]),1)]),_:2},1032,["model-value","input-value"])),64))]),m("div",Ve,[L(h(y(u)({hans:"二级分组：",hant:"二級分組："}))+" ",1),(c(),v(f,null,V(_,(l,s)=>N(y(A),{"model-value":x.value,"onUpdate:modelValue":[n[1]||(n[1]=E=>x.value=E),I],"input-value":s,name:"grouping2",inline:!0,disabled:s!==g.value==(g.value==="none")},{default:D(()=>[L(h(_[s]),1)]),_:2},1032,["model-value","input-value","disabled"])),64))]),m("div",Le,[n[4]||(n[4]=L(" 排序： ",-1)),(c(),v(f,null,V(k,(l,s)=>N(y(A),{key:s,name:"sorting","input-value":s,"model-value":T.value,"onUpdate:modelValue":[n[2]||(n[2]=E=>T.value=E),I],inline:!0},{default:D(()=>[L(h(k[s]),1)]),_:2},1032,["input-value","model-value"])),64))]),m("div",Ne,[(c(),v(f,null,V(S,(l,s)=>N(y(A),{name:"direction","input-value":s,"model-value":M.value,"onUpdate:modelValue":[n[3]||(n[3]=E=>M.value=E),I],inline:!0},{default:D(()=>[L(h(S[s]),1)]),_:2},1032,["input-value","model-value"])),64))])]),g.value==="none"?(c(),v("div",we,[N(J,{levels:b.value},null,8,["levels"])])):(c(),v(f,{key:1},[x.value==="none"?(c(!0),v(f,{key:0},V(b.value,l=>(c(),v(f,null,[m("div",Oe,[m("span",ke,h(l.group),1)]),m("div",Ce,[N(J,{levels:l.list},null,8,["levels"])])],64))),256)):(c(!0),v(f,{key:1},V(b.value,l=>(c(),v(f,null,[l.list.length>0?(c(),v("div",Ie,[m("span",$e,h(l.group),1)])):R("",!0),l.list.length>0?(c(),v("div",De,[(c(!0),v(f,null,V(l.list,s=>(c(),v(f,null,[s.list.length>0?(c(),v("div",Re,[m("span",Ae,h(s.group),1)])):R("",!0),s.list.length>0?(c(),v("div",Te,[N(J,{levels:s.list},null,8,["levels"])])):R("",!0)],64))),256))])):R("",!0)],64))),256))],64)),m("div",{ref_key:"mark",ref:B},null,512)],64))}}),[["__scopeId","data-v-2bcd1869"]]);async function Z(){const e=Q,{getData:a,getValidLevels:o}=e,d=document.querySelectorAll(".navlevel-sortable");$.each(d,async(r,_)=>{se(Array.from(_.querySelectorAll("a[href]")));const k=$(_),S=$("<div/>");S.addClass("navbox hlist navbox-level-0"),k.after(S);try{const[p,C]=await Promise.all([a(),o()]),X=p||[],j=C||[];createApp(W,{data:X,levels:j,preservedElements:Array.from(_.querySelectorAll(".navlevel-sortable-preserve")),titleElement:_.querySelector(".navbox-title")||document.createElement("div")}).mount(S[0])}catch(p){console.error("Failed to initialize NavLevel:",p),createApp(W,{data:[],levels:[],preservedElements:Array.from(_.querySelectorAll(".navlevel-sortable-preserve")),titleElement:_.querySelector(".navbox-title")||document.createElement("div")}).mount(S[0])}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Z):Z()})();

  
});

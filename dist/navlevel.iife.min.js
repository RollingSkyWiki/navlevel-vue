(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".navlevel-nav[data-v-2bcd1869]{display:flex;flex-direction:row;flex-wrap:wrap;gap:2px 1em}.navlevel-radio-group[data-v-2bcd1869]{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;padding:2px}")),document.head.appendChild(e)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();

/// <reference types="types-mediawiki" />
/// <reference types="types-mediawiki-api" />
mw.loader.using(["vue", "@wikimedia/codex", "ext.gadget.HanAssist"], function(require) {
  const vueModule = require("vue");
  const codexModule = require("@wikimedia/codex");
  
  
  const Vue = vueModule;
  const Codex = codexModule;
  
  // 原始代码
  (function(){"use strict";const Y="rswiki:NavLevel-data",H="rswiki:NavLevel-levels",P="rswiki:NavLevel-expiry",z="rswiki:NavLevel-options",ee="https://rs.miraheze.org/";async function U(){const e=await new mw.Api().get({action:"cargoquery",formatversion:2,tables:"Level",fields:"Level.name_zh = name, Level.num = num, Level._pageName = page, Level.type = type, Level.stars = stars, Level.first_came_version = inVer, Level.removed_version = remVer, Level.restored_version = resVer",where:"Level.stars IS NOT NULL AND(Level.type = '官方' OR Level.type = '共创') AND (Level.removed_version IS NULL OR Level.restored_version IS NOT NULL)",limit:500});if(!e.cargoquery)return null;const o=e.cargoquery.map(a=>({...a.title,num:Number(a.title.num),stars:Number(a.title.stars)}));return o.length<210?null:o}async function te(){const e=localStorage.getItem(Y);let o;try{if(!e)throw new Error("No data");o=JSON.parse(e)}catch{}const a=localStorage.getItem(P);if(a&&Number(a)&&Number(a)<Date.now()){console.log("Expired, fetching new data");const p=await U();return p?(localStorage.setItem(Y,JSON.stringify(p)),localStorage.setItem(P,String(Date.now()+432e5)),p):o}return o||(o=await U(),o&&(localStorage.setItem(Y,JSON.stringify(o)),localStorage.setItem(P,String(Date.now()+432e5))),o)}async function ne(){let e=mw.storage.getObject(H);if(e)return e;const o=await fetch(ee+"wiki/Module:NavLevel/levels?action=raw");if(!o.ok)return null;const p=(await o.text()).replace(/^return\s+/,"").replace(/\{/g,"[").replace(/\}/g,"]").replace(/\-\-.*?\n/g,"");try{e=JSON.parse(p)}catch{return null}return mw.storage.setObject(H,e,43200),e}function oe(e){mw.storage.setObject(z,e)}function ae(){const e=mw.storage.getObject(z);return e||null}const K=Object.freeze(Object.defineProperty({__proto__:null,fetchData:U,getData:te,getValidLevels:ne,loadOptionsFromStorage:ae,saveOptionsToStorage:oe},Symbol.toStringTag,{value:"Module"}));let u;({convByVar:u}=require("ext.gadget.HanAssist"));const O=new Map;function le(e){for(const o of e){const a=o.textContent.trim(),p=decodeURI(o.href.split("wiki/")[1]);O.set(p,a),O.set(a,a),O.set(p.replace(/_/g," "),a),O.set(a.replace(/_/g," "),a)}}function re(e){return O.get(e)||e}function se(e){return u({hans:"共创",hant:"共創"})}const ie=Vue.defineComponent,ue=Vue.renderList,ce=Vue.Fragment,q=Vue.openBlock,F=Vue.createElementBlock,ve=Vue.toDisplayString,de=Vue.createElementVNode,pe={class:"hlist"},ge=["href","title"],J=ie({__name:"HList",props:{levels:{}},setup(e){console.log(u);function o(a){return re(a.page)}return(a,p)=>(q(),F("ul",pe,[(q(!0),F(ce,null,ue(e.levels,r=>(q(),F("li",null,[de("a",{href:`/wiki/${encodeURI(r.page)}`,title:`${r.type==="官方"?"Lv.":"Co."}${r.num} ${o(r)} ${"★".repeat(r.stars)}`},ve(o(r)),9,ge)]))),256))]))}}),me=Vue.defineComponent,y=Vue.unref,f=Vue.toDisplayString,g=Vue.createElementVNode,b=Vue.renderList,m=Vue.Fragment,c=Vue.openBlock,v=Vue.createElementBlock,E=Vue.createTextVNode,D=Vue.withCtx,L=Vue.createVNode,R=Vue.createCommentVNode,_e={class:"navbox-cell navbox-sole-row navbox-title stikitable-cell"},fe={class:"navbox-title-content"},he={href:"/wiki/关卡"},xe={class:"navbox-above navbox-cell navbox-sole-row"},ye={class:"navbox-above navbox-cell navbox-sole-row navlevel-nav"},Se={class:"navlevel-radio-group"},Ve={class:"navlevel-radio-group"},be={class:"navlevel-radio-group"},Ee={class:"navlevel-radio-group"},Le={key:0,class:"navbox-list navbox-sole-row"},Ne={class:"navbox-group navbox-cell"},we={class:"navbox-group-flex-inner"},Oe={class:"navbox-list navbox-cell"},ke={key:0,class:"navbox-group navbox-cell"},Ce={class:"navbox-group-flex-inner"},Ie={key:1,class:"navbox navbox-list navbox-cell navbox-level-1 mobileplainbox"},$e={key:0,class:"navbox-group navbox-cell"},De={class:"navbox-group-flex-inner"},Re={key:1,class:"navbox-list navbox-cell"},T=Codex.CdxRadio,Te=Vue.onMounted,w=Vue.ref,Me=((e,o)=>{const a=e.__vccOpts||e;for(const[p,r]of o)a[p]=r;return a})(me({__name:"Main",props:{data:{},levels:{},preservedElements:{},titleElement:{}},setup(e){const o=K,{saveOptionsToStorage:a,loadOptionsFromStorage:p}=o,r=e,h={type:u({hans:"类型",hant:"類型"}),era:u({hans:"时期",hant:"時期"}),stars:u({hans:"星数",hant:"星數"}),none:u({hans:"无",hant:"無"})},k={num:u({hans:"编号",hant:"編號"}),name:u({hans:"名称",hant:"名稱"}),stars:u({hans:"星数",hant:"星數"}),default:u({hans:"默认",hant:"預設"})},N={asc:"升序",desc:"降序"},d=p();function C(t){return t in h}function Q(t){return t in k}function Ae(t){return t in N}const _=w(d?.grouping1&&C(d.grouping1)?d.grouping1:"type"),x=w(d?.grouping2&&C(d.grouping2)?d.grouping2:"stars"),M=w(d?.sorting&&Q(d.sorting)?d.sorting:"default"),A=w(d?.direction&&Ae(d.direction)?d.direction:"asc"),B=w(null),S=w({});Te(()=>{if(B.value&&r.preservedElements?.length){r.preservedElements[0].parentElement.remove();let n=B.value;r.preservedElements.forEach(l=>{l&&n.parentNode&&(n.parentNode.insertBefore(l,n.nextSibling),n=l)}),B.value.remove()}I()});function W(t,n){switch(M.value){case"num":return t.type===n.type?t.num-n.num:t.type==="官方"?-1:1;case"name":return t.name.localeCompare(n.name);case"stars":return t.stars-n.stars||r.levels.indexOf(t.page)-r.levels.indexOf(n.page);case"default":return r.levels.indexOf(t.page)-r.levels.indexOf(n.page);default:return 0}}function Z(t,n){return A.value==="asc"?W(t,n):W(n,t)}function Be(t,n){switch(n){case"era":return[{group:"辣椒",list:t.filter(i=>i.type==="官方"&&i.num<=7)},{group:u({hans:"猎豹",hant:"獵豹"}),list:t.filter(i=>i.type==="官方"&&i.num>7&&i.num<=94)},{group:u({hans:"米麦",hant:"米麥"}),list:t.filter(i=>i.type==="共创"||i.type==="官方"&&i.num>94)}];case"type":const l=[];return l.push({group:"官方",list:t.filter(i=>i.type==="官方")}),l.push({group:se(),list:t.filter(i=>i.type==="共创")}),l;case"stars":const s=new Set;return t.forEach(i=>s.add(i.stars)),Array.from(s).sort((i,j)=>i-j).map(i=>({group:i+" 星",list:t.filter(j=>j.stars===i)}));default:return t}}function X(t,n){return Be(t,n).map(l=>(l.list=l.list.sort(Z),l))}function I(){if(_.value===x.value&&x.value!=="none"&&(x.value=_.value==="stars"?"type":"stars"),_.value==="none"&&(x.value="none"),a({grouping1:_.value,grouping2:x.value,sorting:M.value,direction:A.value}),_.value==="none"){S.value=[...r.data].sort(Z);return}else x.value==="none"?(S.value=X(r.data,_.value),console.log(S.value)):(S.value=X(r.data,_.value).map(t=>(t.list=X(t.list,x.value),t)),console.log(S.value))}return(t,n)=>(c(),v(m,null,[g("div",_e,[g("span",fe,[g("a",he,f(y(u)({hans:"关卡",hant:"關卡"})),1)])]),g("div",xe,f(y(u)({hans:`本智能排序为实验性功能。当前获取到 ${e.data.length} 个关卡的数据。`,hant:`本智能排序為實驗性功能。當前獲取到 ${e.data.length} 個關卡的數據。`})),1),g("div",ye,[g("div",Se,[E(f(y(u)({hans:"一级分组：",hant:"一級分組："}))+" ",1),(c(),v(m,null,b(h,(l,s)=>L(y(T),{"model-value":_.value,"onUpdate:modelValue":[n[0]||(n[0]=V=>_.value=V),I],"input-value":s,name:"grouping1",inline:!0},{default:D(()=>[E(f(h[s]),1)]),_:2},1032,["model-value","input-value"])),64))]),g("div",Ve,[E(f(y(u)({hans:"二级分组：",hant:"二級分組："}))+" ",1),(c(),v(m,null,b(h,(l,s)=>L(y(T),{"model-value":x.value,"onUpdate:modelValue":[n[1]||(n[1]=V=>x.value=V),I],"input-value":s,name:"grouping2",inline:!0,disabled:s!==_.value==(_.value==="none")},{default:D(()=>[E(f(h[s]),1)]),_:2},1032,["model-value","input-value","disabled"])),64))]),g("div",be,[n[4]||(n[4]=E(" 排序： ",-1)),(c(),v(m,null,b(k,(l,s)=>L(y(T),{key:s,name:"sorting","input-value":s,"model-value":M.value,"onUpdate:modelValue":[n[2]||(n[2]=V=>M.value=V),I],inline:!0},{default:D(()=>[E(f(k[s]),1)]),_:2},1032,["input-value","model-value"])),64))]),g("div",Ee,[(c(),v(m,null,b(N,(l,s)=>L(y(T),{name:"direction","input-value":s,"model-value":A.value,"onUpdate:modelValue":[n[3]||(n[3]=V=>A.value=V),I],inline:!0},{default:D(()=>[E(f(N[s]),1)]),_:2},1032,["input-value","model-value"])),64))])]),_.value==="none"?(c(),v("div",Le,[L(J,{levels:S.value},null,8,["levels"])])):(c(),v(m,{key:1},[x.value==="none"?(c(!0),v(m,{key:0},b(S.value,l=>(c(),v(m,null,[g("div",Ne,[g("span",we,f(l.group),1)]),g("div",Oe,[L(J,{levels:l.list},null,8,["levels"])])],64))),256)):(c(!0),v(m,{key:1},b(S.value,l=>(c(),v(m,null,[l.list.length>0?(c(),v("div",ke,[g("span",Ce,f(l.group),1)])):R("",!0),l.list.length>0?(c(),v("div",Ie,[(c(!0),v(m,null,b(l.list,s=>(c(),v(m,null,[s.list.length>0?(c(),v("div",$e,[g("span",De,f(s.group),1)])):R("",!0),s.list.length>0?(c(),v("div",Re,[L(J,{levels:s.list},null,8,["levels"])])):R("",!0)],64))),256))])):R("",!0)],64))),256))],64)),g("div",{ref_key:"mark",ref:B},null,512)],64))}}),[["__scopeId","data-v-2bcd1869"]]);async function G(){const e=K,{getData:o,getValidLevels:a}=e,p=document.querySelectorAll(".navlevel-sortable");$.each(p,async(r,h)=>{le(Array.from(h.querySelectorAll("a[href]")));const k=$(h),N=$("<div/>");N.addClass("navbox hlist navbox-level-0"),k.after(N);try{const[d,C]=await Promise.all([o(),a()]);if(!d||!C)return;Vue.createApp(Me,{data:d,levels:C,preservedElements:Array.from(h.querySelectorAll(".navlevel-sortable-preserve")),titleElement:h.querySelector(".navbox-title")||document.createElement("div")}).mount(N[0])}catch(d){console.error("Failed to initialize NavLevel:",d)}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G()})();

  
});

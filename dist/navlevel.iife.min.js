(function(){"use strict";try{if(typeof document<"u"){var r=document.createElement("style");r.appendChild(document.createTextNode(".priority-sort[data-v-ca757e80]{display:flex;align-items:center;gap:var(--spacing-50, 8px);flex-wrap:wrap}.priority-chip[data-v-ca757e80]{display:inline-flex;align-items:center;padding:var(--spacing-25, 4px) var(--spacing-25, 4px);background-color:var(--background-color-base, #f8f9fa);border:1px solid var(--border-color-subtle, #c8ccd1);border-radius:var(--border-radius-base, 4px);color:var(--color-base, #202122);font-size:var(--font-size-small, .8125rem);font-weight:var(--font-weight-normal, 400);font-family:var(--font-family-system-sans, sans-serif);cursor:pointer;transition:all var(--transition-duration-base, .1s) var(--transition-timing-function-ease-in-out, ease-in-out);white-space:nowrap;-webkit-user-select:none;user-select:none}.priority-chip[data-v-ca757e80]:hover{background-color:var(--background-color-interactive-subtle, #eaecf0);border-color:var(--border-color-interactive, #72777d)}.priority-chip[data-v-ca757e80]:focus{outline:2px solid var(--color-progressive, #36c);outline-offset:2px}.priority-chip[data-v-ca757e80]:active{background-color:var(--background-color-interactive, #eaf3ff);border-color:var(--color-progressive, #36c)}.priority-arrow[data-v-ca757e80]{color:var(--color-subtle, #54595d);font-weight:var(--font-weight-bold, 700);margin:0 var(--spacing-25, 4px)}@media(max-width:768px){.priority-sort[data-v-ca757e80]{gap:var(--spacing-35, 6px)}.priority-arrow[data-v-ca757e80]{margin:0 var(--spacing-15, 2px)}}.navlevel-nav[data-v-87413118]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1em}.navlevel-radio-group[data-v-87413118]{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;padding:2px}.navlevel-sortable .navbox-title{z-index:1}")),document.head.appendChild(r)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();

/// <reference types="types-mediawiki" />
/// <reference types="types-mediawiki-api" />
mw.loader.using(["vue", "@wikimedia/codex", "ext.gadget.HanAssist"], function(require) {
  const vueModule = require("vue");
  const codexModule = require("@wikimedia/codex");
  
  
  const Vue = vueModule;
  const Codex = codexModule;
  
  // 原始代码
  (function(){"use strict";const F="rswiki:NavLevel-data",H="rswiki:NavLevel-levels",Y="rswiki:NavLevel-expiry",le="rswiki:NavLevel-options",_e="https://rs.miraheze.org/";async function z(){const e=await new mw.Api().get({action:"cargoquery",formatversion:2,tables:"Level",fields:"Level.name_zh = name, Level.num = num, Level._pageName = page, Level.type = type, Level.stars = stars, Level.first_came_version = inVer, Level.removed_version = remVer, Level.restored_version = resVer",where:"Level.stars IS NOT NULL AND(Level.type = '官方' OR Level.type = '共创') AND Level._pageName NOT LIKE '%（旧）'",limit:500});if(!e.cargoquery)return null;const a=e.cargoquery.map(i=>({...i.title,num:Number(i.title.num),stars:Number(i.title.stars)}));return a.length<210?null:a}async function he(){const e=localStorage.getItem(F);let a;try{if(!e)throw new Error("No data");a=JSON.parse(e)}catch{}const i=localStorage.getItem(Y);if(i&&Number(i)&&Number(i)<Date.now()){console.log("Expired, fetching new data");const n=await z();return n?(localStorage.setItem(F,JSON.stringify(n)),localStorage.setItem(Y,String(Date.now()+432e5)),n):a}return a||(a=await z(),a&&(localStorage.setItem(F,JSON.stringify(a)),localStorage.setItem(Y,String(Date.now()+432e5))),a)}async function G(){const e=await fetch(_e+"wiki/Module:NavLevel/levels?action=raw");if(!e.ok)return null;const i=(await e.text()).replace(/^return\s+/,"").replace(/\{/g,"[").replace(/\}/g,"]").replace(/\-\-.*?\n/g,"");try{return JSON.parse(i)}catch{return null}}async function ye(){let e=mw.storage.getObject(H);return e||(e=await G(),mw.storage.setObject(H,e,43200),e)}function Ve(e){mw.storage.setObject(le,e)}function be(){const e=mw.storage.getObject(le);return e||null}function ie(e){return mw.config.get("wgPageName").replace(/_/g," ")===e.replace(/_/g," ")}async function Se(){const e=await G(),a=await z();return e&&mw.storage.setObject(H,e,43200),a&&(localStorage.setItem(F,JSON.stringify(a)),localStorage.setItem(Y,String(Date.now()+432e5))),{levels:e,data:a}}const ue=Object.freeze(Object.defineProperty({__proto__:null,fetchData:z,fetchLevels:G,getData:he,getValidLevels:ye,hotPurge:Se,isCurrentPage:ie,loadOptionsFromStorage:be,saveOptionsToStorage:Ve},Symbol.toStringTag,{value:"Module"}));let v;({convByVar:v}=require("ext.gadget.HanAssist"));const B=new Map;function we(e){for(const a of e){const i=a.textContent.trim(),n=decodeURI(a.href.split("wiki/")[1]);B.set(n,i),B.set(i,i),B.set(n.replace(/_/g," "),i),B.set(i.replace(/_/g," "),i)}}function Ee(e){return B.get(e)||e}function Ne(e){return v({hans:"共创",hant:"共創"})}const Le=Vue.defineComponent,ke=Vue.renderList,xe=Vue.Fragment,W=Vue.openBlock,Q=Vue.createElementBlock,Z=Vue.unref,$e=Vue.toDisplayString,Ce=Vue.normalizeClass,De=Vue.createElementVNode,Oe={class:"hlist"},Ie=["href","title"],ee=Le({__name:"HList",props:{levels:{}},setup(e){const a=ie;function i(n){return Ee(n.page)}return(n,h)=>(W(),Q("ul",Oe,[(W(!0),Q(xe,null,ke(e.levels,d=>(W(),Q("li",null,[De("a",{href:Z(a)(d.page)?void 0:`/wiki/${encodeURI(d.page)}`,title:`${d.type==="官方"?"Lv.":"Co."}${d.num} ${i(d)} ${"★".repeat(d.stars)}
${d.inVer}${Z(v)({hans:"版本加入游戏",hant:"版本加入遊戲"})}`,class:Ce(Z(a)(d.page)?"mw-selflink selflink":"")},$e(i(d)),11,Ie)]))),256))]))}}),Pe=Vue.useModel,ce=Vue.mergeModels,Ae=Vue.defineComponent,Be=Vue.renderList,ve=Vue.Fragment,J=Vue.openBlock,X=Vue.createElementBlock,Re=Vue.toDisplayString,Me=Vue.createElementVNode,Te=Vue.createCommentVNode,qe={class:"priority-sort",role:"list","aria-label":"优先级排序"},Fe=["onClick","onKeydown","aria-label"],Ye={key:0,class:"priority-arrow","aria-hidden":"true"};Vue.computed;const te=Vue.nextTick,ze=Ae({__name:"PrioritySort",props:ce({labelMap:{default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:ce(["update:modelValue"],["update:modelValue"]),setup(e,{emit:a}){const i=e,n=Pe(e,"modelValue"),h=a,d=p=>i.labelMap[p]||p,R=(p,l)=>{C(p.currentTarget,l),h("update:modelValue",n.value)},b=(p,l)=>{const y=p.currentTarget;switch(p.key){case"Enter":case" ":p.preventDefault(),C(y,l);break;case"ArrowLeft":p.preventDefault(),D(y,l);break;case"ArrowRight":p.preventDefault(),m(y,l);break}h("update:modelValue",n.value)},C=(p,l)=>{if(l<=0)return;const[y]=n.value.splice(l,1);n.value.unshift(y);const c=p.parentElement;te(()=>{Array.from(c?.querySelectorAll(".priority-chip")||[])[0]?.focus()})},D=(p,l)=>{if(l<=0)return;const y=p.parentElement,c=n.value[l];n.value[l]=n.value[l-1],n.value[l-1]=c,te(()=>{Array.from(y?.querySelectorAll(".priority-chip")||[])[l-1]?.focus()})},m=(p,l)=>{if(l>=n.value.length-1)return;const y=p.parentElement,c=n.value[l];n.value[l]=n.value[l+1],n.value[l+1]=c,te(()=>{Array.from(y?.querySelectorAll(".priority-chip")||[])[l+1]?.focus()})};return(p,l)=>(J(),X("div",qe,[(J(!0),X(ve,null,Be(n.value,(y,c)=>(J(),X(ve,{key:y},[Me("button",{type:"button",class:"priority-chip",onClick:f=>R(f,c),onKeydown:f=>b(f,c),"aria-label":`${d(y)}，点击设为第一优先级，左右箭头键移动一位`},Re(d(y)),41,Fe),c<n.value.length-1?(J(),X("span",Ye,">")):Te("",!0)],64))),128))]))}}),pe=(e,a)=>{const i=e.__vccOpts||e;for(const[n,h]of a)i[n]=h;return i},Je=pe(ze,[["__scopeId","data-v-ca757e80"]]),de=mw.loader.getState("ext.gadget.separate-space")==="ready";function K(e){return de?" "+e+" ":e}function Xe(e){return de?e+" ":e}const Ke=Vue.defineComponent,V=Vue.createElementVNode,E=Vue.unref,S=Vue.toDisplayString,x=Vue.createTextVNode,I=Vue.renderList,w=Vue.Fragment,g=Vue.openBlock,_=Vue.createElementBlock,ne=Vue.withCtx,O=Vue.createVNode,re=Vue.normalizeClass,j=Vue.createCommentVNode,je={class:"navbox-above navbox-cell navbox-sole-row"},Ue={class:"navbox-above navbox-cell navbox-sole-row navlevel-nav"},He={class:"navlevel-radio-group"},Ge={class:"navlevel-radio-group"},We={class:"navlevel-radio-group"},Qe={class:"navlevel-radio-group"},Ze={class:"navbox-group navbox-cell"},et={class:"navbox-group-flex-inner"},tt={key:0,class:"navbox-group navbox-cell"},nt={class:"navbox-group-flex-inner"},rt={key:1,class:"navbox navbox-list navbox-cell navbox-level-1 mobileplainbox"},ot={key:0,class:"navbox-group navbox-cell"},at={class:"navbox-group-flex-inner"},oe=Codex.CdxRadio;Vue.computed;const st=Vue.onMounted,L=Vue.ref,lt=pe(Ke({__name:"Main",props:{recvData:{},recvLevels:{},preserveElements:{},preserveBeforeElements:{},titleElement:{}},setup(e){const a=ue,{saveOptionsToStorage:i,loadOptionsFromStorage:n}=a,h=e,d=L(h.recvData),R=L(h.recvLevels),b={type:v({hans:"类型",hant:"類型"}),era:v({hans:"时期",hant:"時期"}),stars:v({hans:"星数",hant:"星數"}),version:v({hans:"版本",hant:"版本"}),none:v({hans:"无",hant:"無"})},C={num:v({hans:"编号",hant:"編號"}),name:v({hans:"名称",hant:"名稱"}),stars:v({hans:"星数",hant:"星數"}),default:v({hans:"默认",hant:"預設"})},D={asc:"升序",desc:"降序"},m=n();function p(t){return t in b}function l(t){return t in C}function y(t){return t in D}const c=L(m?.grouping1&&p(m.grouping1)?m.grouping1:"type"),f=L(m?.grouping2&&p(m.grouping2)?m.grouping2:"stars"),U=L(m?.direction&&y(m.direction)?m.direction:"asc"),M=L(m?.sortingPriority&&Array.isArray(m.sortingPriority)&&m.sortingPriority.every(t=>l(t))?m.sortingPriority:["default","num","name","stars"]),T=L(null),q=L(null),P=L({});st(()=>{if(q.value&&h.preserveBeforeElements?.length){let t=q.value;h.preserveBeforeElements.forEach(r=>{r&&t.parentNode&&(t.parentNode.insertBefore(r,t),t=r)})}if(T.value&&h.preserveElements?.length){let t=T.value;h.preserveElements.forEach(r=>{r&&t&&t.parentNode&&(t.parentNode.insertBefore(r,t.nextSibling),t=r)})}T.value&&T.value.remove(),q.value&&q.value.remove(),A()});function ut(t){const r=R.value;switch(t){case"num":return(o,u)=>o.type===u.type?o.num-u.num:o.type==="官方"?-1:1;case"name":return(o,u)=>o.name.localeCompare(u.name);case"stars":return(o,u)=>o.stars-u.stars;case"default":return(o,u)=>r.indexOf(o.page)-r.indexOf(u.page);default:return()=>0}}function me(t,r){for(let o=0;o<M.value.length;o++){const u=ut(M.value[o])(t,r);if(u!==0)return u*(U.value==="asc"?1:-1)}return 0}function ct(t,r){switch(r){case"era":return[{group:"辣椒",list:t.filter(s=>s.type==="官方"&&s.num<=7)},{group:v({hans:"猎豹",hant:"獵豹"}),list:t.filter(s=>s.type==="官方"&&s.num>7&&s.num<=94)},{group:v({hans:"米麦",hant:"米麥"}),list:t.filter(s=>s.type==="共创"||s.type==="官方"&&s.num>94)}];case"version":const o=new Set;return t.forEach(s=>o.add(s.inVer.substring(0,1))),o.delete("3"),Array.from(o).sort((s,N)=>s.localeCompare(N)).map(s=>({group:s==="2"?"2.x / 3.x":s+".x",list:s==="2"?t.filter(N=>N.inVer.startsWith("2")||N.inVer.startsWith("3")):t.filter(N=>N.inVer.startsWith(s))}));case"type":const k=[];return k.push({group:"官方",list:t.filter(s=>s.type==="官方")}),k.push({group:Ne(),list:t.filter(s=>s.type==="共创")}),k;case"stars":const ge=new Set;return t.forEach(s=>ge.add(s.stars)),Array.from(ge).sort((s,N)=>s-N).map(s=>({group:Xe(s.toString())+"星",list:t.filter(N=>N.stars===s)}));default:return t}}function ae(t,r){return ct(t,r).map(o=>(o.list=o.list.sort(me),o))}let fe=0;function A(){fe=0,c.value===f.value&&f.value!=="none"&&(f.value=c.value==="stars"?"type":"stars"),c.value==="none"&&(f.value="none"),i({grouping1:c.value,grouping2:f.value,sortingPriority:M.value,direction:U.value});const t=d.value;if(c.value==="none"){P.value=[...t].sort(me);return}else f.value==="none"?P.value=ae(t,c.value):P.value=ae(t,c.value).map(r=>(r.list=ae(r.list,f.value),r))}function se(){return++fe%2?"navbox-odd":"navbox-even"}async function vt(){const{levels:t,data:r}=await a.hotPurge();t?R.value=t:mw.notify(v({hans:"获取合法关卡列表失败。",hant:"獲取合法關卡列表失敗。"}),{type:"error"}),r?d.value=r:mw.notify(v({hans:`获取关卡${K("Cargo")}数据失败。`,hant:`獲取關卡${K("Cargo")}數據失敗。`}),{type:"error"}),A()}return(t,r)=>(g(),_(w,null,[V("div",{ref_key:"markerBefore",ref:q},null,512),V("div",je,[x(S(E(v)({hans:`本智能排序为实验性功能。当前获取到${E(K)(d.value.length)}个关卡的数据。`,hant:`本智能排序為實驗性功能。當前獲取到${E(K)(d.value.length)}個關卡的數據。`}))+" （",1),V("a",{onClick:vt,role:"button",tabindex:"0"},S(E(v)({hans:"清除缓存",hant:"清除快取"})),1),r[5]||(r[5]=x("） ",-1))]),V("div",Ue,[V("div",He,[x(S(E(v)({hans:"一级分组：",hant:"一級分組："}))+" ",1),(g(),_(w,null,I(b,(o,u)=>O(E(oe),{"model-value":c.value,"onUpdate:modelValue":[r[0]||(r[0]=k=>c.value=k),A],"input-value":u,name:"grouping1",inline:!0},{default:ne(()=>[x(S(b[u]),1)]),_:2},1032,["model-value","input-value"])),64))]),V("div",Ge,[x(S(E(v)({hans:"二级分组：",hant:"二級分組："}))+" ",1),(g(),_(w,null,I(b,(o,u)=>O(E(oe),{"model-value":f.value,"onUpdate:modelValue":[r[1]||(r[1]=k=>f.value=k),A],"input-value":u,name:"grouping2",inline:!0,disabled:u!==c.value==(c.value==="none")},{default:ne(()=>[x(S(b[u]),1)]),_:2},1032,["model-value","input-value","disabled"])),64))]),V("div",We,[x(S(E(v)({hans:"排序：",hant:"排序："}))+" ",1),O(Je,{modelValue:M.value,"onUpdate:modelValue":[r[2]||(r[2]=o=>M.value=o),r[3]||(r[3]=o=>A())],"label-map":C},null,8,["modelValue"])]),V("div",Qe,[(g(),_(w,null,I(D,(o,u)=>O(E(oe),{name:"direction","input-value":u,"model-value":U.value,"onUpdate:modelValue":[r[4]||(r[4]=k=>U.value=k),A],inline:!0},{default:ne(()=>[x(S(D[u]),1)]),_:2},1032,["input-value","model-value"])),64))])]),c.value==="none"?(g(),_("div",{key:0,class:re("navbox-list navbox-sole-row "+se())},[O(ee,{levels:P.value},null,8,["levels"])],2)):(g(),_(w,{key:1},[f.value==="none"?(g(!0),_(w,{key:0},I(P.value,o=>(g(),_(w,null,[V("div",Ze,[V("span",et,S(o.group),1)]),V("div",{class:re("navbox-list navbox-cell "+se())},[O(ee,{levels:o.list},null,8,["levels"])],2)],64))),256)):(g(!0),_(w,{key:1},I(P.value,o=>(g(),_(w,null,[o.list.length>0?(g(),_("div",tt,[V("span",nt,S(o.group),1)])):j("",!0),o.list.length>0?(g(),_("div",rt,[(g(!0),_(w,null,I(o.list,u=>(g(),_(w,null,[u.list.length>0?(g(),_("div",ot,[V("span",at,S(u.group),1)])):j("",!0),u.list.length>0?(g(),_("div",{key:1,class:re("navbox-list navbox-cell "+se())},[O(ee,{levels:u.list},null,8,["levels"])],2)):j("",!0)],64))),256))])):j("",!0)],64))),256))],64)),V("div",{ref_key:"mark",ref:T},null,512)],64))}}),[["__scopeId","data-v-87413118"]]);async function it(){const e=ue,{getData:a,getValidLevels:i}=e;try{const[n,h]=await Promise.all([a(),i()]);if(!n||!h){mw.notify("Failed to fetch qualified data",{type:"error"});return}const d=document.querySelectorAll(".navlevel-sortable:not(.navlevel-sortable-processed)");$.each(d,async(R,b)=>{we(Array.from(b.querySelectorAll("a[href]")));const C=Array.from(b.querySelectorAll(".navlevel-sortable-preserve")),D=Array.from(b.querySelectorAll(".navlevel-sortable-preserve-before"));[...C,...D].forEach(l=>{l.parentNode&&l.parentNode.removeChild(l)});const m=$(b);m.empty(),m.addClass("navlevel-sortable-processed"),Vue.createApp(lt,{recvData:n,recvLevels:h,preserveElements:C,preserveBeforeElements:D,titleElement:b.querySelector(".navbox-title")||document.createElement("div")}).mount(b)})}catch(n){console.error("Failed to initialize NavLevel:",n),mw.notify("Failed to initialize NavLevel: "+n.message,{type:"error"})}}mw.hook("wikipage.content").add(it)})();

  
});

(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".navlevel-nav[data-v-4f4fb056]{display:flex;flex-direction:row;flex-wrap:wrap;gap:2px 1em}.navlevel-radio-group[data-v-4f4fb056]{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;padding:2px}.navlevel-sortable .navbox-title{z-index:1}")),document.head.appendChild(e)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();

/// <reference types="types-mediawiki" />
/// <reference types="types-mediawiki-api" />
mw.loader.using(["vue", "@wikimedia/codex", "ext.gadget.HanAssist"], function(require) {
  const vueModule = require("vue");
  const codexModule = require("@wikimedia/codex");
  
  
  const Vue = vueModule;
  const Codex = codexModule;
  
  // 原始代码
  (function(){"use strict";const q="rswiki:NavLevel-data",Q="rswiki:NavLevel-levels",F="rswiki:NavLevel-expiry",W="rswiki:NavLevel-options",ie="https://rs.miraheze.org/";async function z(){const t=await new mw.Api().get({action:"cargoquery",formatversion:2,tables:"Level",fields:"Level.name_zh = name, Level.num = num, Level._pageName = page, Level.type = type, Level.stars = stars, Level.first_came_version = inVer, Level.removed_version = remVer, Level.restored_version = resVer",where:"Level.stars IS NOT NULL AND(Level.type = '官方' OR Level.type = '共创') AND (Level.removed_version IS NULL OR Level.restored_version IS NOT NULL)",limit:500});if(!t.cargoquery)return null;const a=t.cargoquery.map(r=>({...r.title,num:Number(r.title.num),stars:Number(r.title.stars)}));return a.length<210?null:a}async function ue(){const t=localStorage.getItem(q);let a;try{if(!t)throw new Error("No data");a=JSON.parse(t)}catch{}const r=localStorage.getItem(F);if(r&&Number(r)&&Number(r)<Date.now()){console.log("Expired, fetching new data");const o=await z();return o?(localStorage.setItem(q,JSON.stringify(o)),localStorage.setItem(F,String(Date.now()+432e5)),o):a}return a||(a=await z(),a&&(localStorage.setItem(q,JSON.stringify(a)),localStorage.setItem(F,String(Date.now()+432e5))),a)}async function ce(){let t=mw.storage.getObject(Q);if(t)return t;const a=await fetch(ie+"wiki/Module:NavLevel/levels?action=raw");if(!a.ok)return null;const o=(await a.text()).replace(/^return\s+/,"").replace(/\{/g,"[").replace(/\}/g,"]").replace(/\-\-.*?\n/g,"");try{t=JSON.parse(o)}catch{return null}return mw.storage.setObject(Q,t,43200),t}function ve(t){mw.storage.setObject(W,t)}function de(){const t=mw.storage.getObject(W);return t||null}function Z(t){return mw.config.get("wgPageName").replace(/_/g," ")===t.replace(/_/g," ")}const ee=Object.freeze(Object.defineProperty({__proto__:null,fetchData:z,getData:ue,getValidLevels:ce,isCurrentPage:Z,loadOptionsFromStorage:de,saveOptionsToStorage:ve},Symbol.toStringTag,{value:"Module"}));let g;({convByVar:g}=require("ext.gadget.HanAssist"));const k=new Map;function pe(t){for(const a of t){const r=a.textContent.trim(),o=decodeURI(a.href.split("wiki/")[1]);k.set(o,r),k.set(r,r),k.set(o.replace(/_/g," "),r),k.set(r.replace(/_/g," "),r)}}function ge(t){return k.get(t)||t}function fe(t){return g({hans:"共创",hant:"共創"})}const me=Vue.defineComponent,_e=Vue.renderList,he=Vue.Fragment,U=Vue.openBlock,J=Vue.createElementBlock,te=Vue.unref,ye=Vue.toDisplayString,xe=Vue.normalizeClass,Ne=Vue.createElementVNode,Se={class:"hlist"},Ve=["href","title"],X=me({__name:"HList",props:{levels:{}},setup(t){const a=Z;function r(o){return ge(o.page)}return(o,u)=>(U(),J("ul",Se,[(U(!0),J(he,null,_e(t.levels,d=>(U(),J("li",null,[Ne("a",{href:te(a)(d.page)?void 0:`/wiki/${encodeURI(d.page)}`,title:`${d.type==="官方"?"Lv.":"Co."}${d.num} ${r(d)} ${"★".repeat(d.stars)}`,class:xe(te(a)(d.page)?"mw-selflink selflink":"")},ye(r(d)),11,Ve)]))),256))]))}}),ne=mw.loader.getState("ext.gadget.separate-space")==="ready";function ae(t){return ne?" "+t+" ":t}function Ee(t){return ne?t+" ":t}const we=Vue.defineComponent,m=Vue.createElementVNode,N=Vue.unref,h=Vue.toDisplayString,V=Vue.renderList,_=Vue.Fragment,c=Vue.openBlock,v=Vue.createElementBlock,E=Vue.createTextVNode,R=Vue.withCtx,w=Vue.createVNode,j=Vue.normalizeClass,B=Vue.createCommentVNode,Le={class:"navbox-above navbox-cell navbox-sole-row"},be={class:"navbox-above navbox-cell navbox-sole-row navlevel-nav"},ke={class:"navlevel-radio-group"},Oe={class:"navlevel-radio-group"},Ce={class:"navlevel-radio-group"},$e={class:"navlevel-radio-group"},Ie={class:"navbox-group navbox-cell"},De={class:"navbox-group-flex-inner"},Re={key:0,class:"navbox-group navbox-cell"},Be={class:"navbox-group-flex-inner"},Ae={key:1,class:"navbox navbox-list navbox-cell navbox-level-1 mobileplainbox"},Pe={key:0,class:"navbox-group navbox-cell"},Te={class:"navbox-group-flex-inner"},A=Codex.CdxRadio,Me=Vue.onMounted,L=Vue.ref,Ye=((t,a)=>{const r=t.__vccOpts||t;for(const[o,u]of a)r[o]=u;return r})(we({__name:"Main",props:{data:{},levels:{},preserveElements:{},preserveBeforeElements:{},titleElement:{}},setup(t){const a=ee,{saveOptionsToStorage:r,loadOptionsFromStorage:o}=a,u=t,d={type:g({hans:"类型",hant:"類型"}),era:g({hans:"时期",hant:"時期"}),stars:g({hans:"星数",hant:"星數"}),none:g({hans:"无",hant:"無"})},P={num:g({hans:"编号",hant:"編號"}),name:g({hans:"名称",hant:"名稱"}),stars:g({hans:"星数",hant:"星數"}),default:g({hans:"默认",hant:"預設"})},y={asc:"升序",desc:"降序"},f=o();function O(e){return e in d}function T(e){return e in P}function re(e){return e in y}const p=L(f?.grouping1&&O(f.grouping1)?f.grouping1:"type"),x=L(f?.grouping2&&O(f.grouping2)?f.grouping2:"stars"),M=L(f?.sorting&&T(f.sorting)?f.sorting:"default"),Y=L(f?.direction&&re(f.direction)?f.direction:"asc"),C=L(null),I=L(null),b=L({});Me(()=>{if(I.value&&u.preserveBeforeElements?.length){let e=I.value;u.preserveBeforeElements.forEach(n=>{n&&e.parentNode&&(e.parentNode.insertBefore(n,e),e=n)})}if(C.value&&u.preserveElements?.length){let e=C.value;u.preserveElements.forEach(n=>{n&&e&&e.parentNode&&(e.parentNode.insertBefore(n,e.nextSibling),e=n)})}C.value&&C.value.remove(),I.value&&I.value.remove(),D()});function oe(e,n){switch(M.value){case"num":return e.type===n.type?e.num-n.num:e.type==="官方"?-1:1;case"name":return e.name.localeCompare(n.name);case"stars":return e.stars-n.stars||u.levels.indexOf(e.page)-u.levels.indexOf(n.page);case"default":return u.levels.indexOf(e.page)-u.levels.indexOf(n.page);default:return 0}}function le(e,n){return Y.value==="asc"?oe(e,n):oe(n,e)}function Fe(e,n){switch(n){case"era":return[{group:"辣椒",list:e.filter(s=>s.type==="官方"&&s.num<=7)},{group:g({hans:"猎豹",hant:"獵豹"}),list:e.filter(s=>s.type==="官方"&&s.num>7&&s.num<=94)},{group:g({hans:"米麦",hant:"米麥"}),list:e.filter(s=>s.type==="共创"||s.type==="官方"&&s.num>94)}];case"type":const i=[];return i.push({group:"官方",list:e.filter(s=>s.type==="官方")}),i.push({group:fe(),list:e.filter(s=>s.type==="共创")}),i;case"stars":const l=new Set;return e.forEach(s=>l.add(s.stars)),Array.from(l).sort((s,G)=>s-G).map(s=>({group:Ee(s.toString())+"星",list:e.filter(G=>G.stars===s)}));default:return e}}function H(e,n){return Fe(e,n).map(i=>(i.list=i.list.sort(le),i))}let se=0;function D(){if(se=0,p.value===x.value&&x.value!=="none"&&(x.value=p.value==="stars"?"type":"stars"),p.value==="none"&&(x.value="none"),r({grouping1:p.value,grouping2:x.value,sorting:M.value,direction:Y.value}),p.value==="none"){b.value=[...u.data].sort(le);return}else x.value==="none"?b.value=H(u.data,p.value):b.value=H(u.data,p.value).map(e=>(e.list=H(e.list,x.value),e))}function K(){return++se%2?"navbox-odd":"navbox-even"}return(e,n)=>(c(),v(_,null,[m("div",{ref_key:"markerBefore",ref:I},null,512),m("div",Le,h(N(g)({hans:`本智能排序为实验性功能。当前获取到${N(ae)(t.data.length)}个关卡的数据。`,hant:`本智能排序為實驗性功能。當前獲取到${N(ae)(t.data.length)}個關卡的數據。`})),1),m("div",be,[m("div",ke,[E(h(N(g)({hans:"一级分组：",hant:"一級分組："}))+" ",1),(c(),v(_,null,V(d,(i,l)=>w(N(A),{"model-value":p.value,"onUpdate:modelValue":[n[0]||(n[0]=S=>p.value=S),D],"input-value":l,name:"grouping1",inline:!0},{default:R(()=>[E(h(d[l]),1)]),_:2},1032,["model-value","input-value"])),64))]),m("div",Oe,[E(h(N(g)({hans:"二级分组：",hant:"二級分組："}))+" ",1),(c(),v(_,null,V(d,(i,l)=>w(N(A),{"model-value":x.value,"onUpdate:modelValue":[n[1]||(n[1]=S=>x.value=S),D],"input-value":l,name:"grouping2",inline:!0,disabled:l!==p.value==(p.value==="none")},{default:R(()=>[E(h(d[l]),1)]),_:2},1032,["model-value","input-value","disabled"])),64))]),m("div",Ce,[n[4]||(n[4]=E(" 排序： ",-1)),(c(),v(_,null,V(P,(i,l)=>w(N(A),{key:l,name:"sorting","input-value":l,"model-value":M.value,"onUpdate:modelValue":[n[2]||(n[2]=S=>M.value=S),D],inline:!0},{default:R(()=>[E(h(P[l]),1)]),_:2},1032,["input-value","model-value"])),64))]),m("div",$e,[(c(),v(_,null,V(y,(i,l)=>w(N(A),{name:"direction","input-value":l,"model-value":Y.value,"onUpdate:modelValue":[n[3]||(n[3]=S=>Y.value=S),D],inline:!0},{default:R(()=>[E(h(y[l]),1)]),_:2},1032,["input-value","model-value"])),64))])]),p.value==="none"?(c(),v("div",{key:0,class:j("navbox-list navbox-sole-row "+K())},[w(X,{levels:b.value},null,8,["levels"])],2)):(c(),v(_,{key:1},[x.value==="none"?(c(!0),v(_,{key:0},V(b.value,i=>(c(),v(_,null,[m("div",Ie,[m("span",De,h(i.group),1)]),m("div",{class:j("navbox-list navbox-cell "+K())},[w(X,{levels:i.list},null,8,["levels"])],2)],64))),256)):(c(!0),v(_,{key:1},V(b.value,i=>(c(),v(_,null,[i.list.length>0?(c(),v("div",Re,[m("span",Be,h(i.group),1)])):B("",!0),i.list.length>0?(c(),v("div",Ae,[(c(!0),v(_,null,V(i.list,l=>(c(),v(_,null,[l.list.length>0?(c(),v("div",Pe,[m("span",Te,h(l.group),1)])):B("",!0),l.list.length>0?(c(),v("div",{key:1,class:j("navbox-list navbox-cell "+K())},[w(X,{levels:l.list},null,8,["levels"])],2)):B("",!0)],64))),256))])):B("",!0)],64))),256))],64)),m("div",{ref_key:"mark",ref:C},null,512)],64))}}),[["__scopeId","data-v-4f4fb056"]]);async function qe(){const t=ee,{getData:a,getValidLevels:r}=t;try{const[o,u]=await Promise.all([a(),r()]);if(!o||!u){mw.notify("Failed to fetch qualified data",{type:"error"});return}const d=document.querySelectorAll(".navlevel-sortable:not(.navlevel-sortable-processed)");$.each(d,async(P,y)=>{pe(Array.from(y.querySelectorAll("a[href]")));const f=Array.from(y.querySelectorAll(".navlevel-sortable-preserve")),O=Array.from(y.querySelectorAll(".navlevel-sortable-preserve-before"));[...f,...O].forEach(p=>{p.parentNode&&p.parentNode.removeChild(p)});const T=$(y);T.empty(),T.addClass("navlevel-sortable-processed"),Vue.createApp(Ye,{data:o,levels:u,preserveElements:f,preserveBeforeElements:O,titleElement:y.querySelector(".navbox-title")||document.createElement("div")}).mount(y)})}catch(o){console.error("Failed to initialize NavLevel:",o),mw.notify("Failed to initialize NavLevel: "+o.message,{type:"error"})}}mw.hook("wikipage.content").add(qe)})();

  
});

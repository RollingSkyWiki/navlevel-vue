(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".priority-sort[data-v-ca757e80]{display:flex;align-items:center;gap:var(--spacing-50, 8px);flex-wrap:wrap}.priority-chip[data-v-ca757e80]{display:inline-flex;align-items:center;padding:var(--spacing-25, 4px) var(--spacing-25, 4px);background-color:var(--background-color-base, #f8f9fa);border:1px solid var(--border-color-subtle, #c8ccd1);border-radius:var(--border-radius-base, 4px);color:var(--color-base, #202122);font-size:var(--font-size-small, .8125rem);font-weight:var(--font-weight-normal, 400);font-family:var(--font-family-system-sans, sans-serif);cursor:pointer;transition:all var(--transition-duration-base, .1s) var(--transition-timing-function-ease-in-out, ease-in-out);white-space:nowrap;-webkit-user-select:none;user-select:none}.priority-chip[data-v-ca757e80]:hover{background-color:var(--background-color-interactive-subtle, #eaecf0);border-color:var(--border-color-interactive, #72777d)}.priority-chip[data-v-ca757e80]:focus{outline:2px solid var(--color-progressive, #36c);outline-offset:2px}.priority-chip[data-v-ca757e80]:active{background-color:var(--background-color-interactive, #eaf3ff);border-color:var(--color-progressive, #36c)}.priority-arrow[data-v-ca757e80]{color:var(--color-subtle, #54595d);font-weight:var(--font-weight-bold, 700);margin:0 var(--spacing-25, 4px)}@media(max-width:768px){.priority-sort[data-v-ca757e80]{gap:var(--spacing-35, 6px)}.priority-arrow[data-v-ca757e80]{margin:0 var(--spacing-15, 2px)}}.navlevel-nav[data-v-a128930d]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.2em 1em}.navlevel-radio-group[data-v-a128930d]{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;padding:2px}a[role=button][data-v-a128930d]{cursor:pointer}.navlevel-sortable .navbox-title{z-index:1}")),document.head.appendChild(a)}}catch(r){console.error("vite-plugin-css-injected-by-js",r)}})();

/// <reference types="types-mediawiki" />
/// <reference types="types-mediawiki-api" />
mw.loader.using(["vue", "@wikimedia/codex", "ext.gadget.HanAssist"], function(require) {
  const vueModule = require("vue");
  const codexModule = require("@wikimedia/codex");
  
  
  const Vue = vueModule;
  const Codex = codexModule;
  
  // åŸå§‹ä»£ç 
  (function(){"use strict";const T="rswiki:NavLevel-data",U="rswiki:NavLevel-levels",F="rswiki:NavLevel-expiry",ue="rswiki:NavLevel-options",Ve="https://rs.miraheze.org/";async function Y(){const n=await new mw.Api().get({action:"cargoquery",formatversion:2,tables:"Level, Version",fields:"Level.name_zh = name, Level.num = num, Level._pageName = page, Level.type = type, Level.stars = stars, Level.first_came_version = inVer, Level.removed_version = remVer, Level.restored_version = resVer, Level.award = award, Level.diamonds = dia, Version.date = inDate",where:"Level.stars IS NOT NULL AND(Level.type = 'å®˜æ–¹' OR Level.type = 'å…±åˆ›') AND Level._pageName NOT LIKE '%ï¼ˆæ—§ï¼‰'",join_on:"Level.first_came_version = Version._pageName",limit:500});if(!n.cargoquery)return null;const l=n.cargoquery.map(o=>({num:Number(o.title.num),stars:Number(o.title.stars),inVer:o.title.inVer,remVer:o.title.remVer,resVer:o.title.resVer,inDate:o.title.inDate,type:o.title.type,page:o.title.page,name:o.title.name,award:o.title.award,dia:Number(o.title.dia)}));return l.length<210?null:l}async function we(){const n=localStorage.getItem(T);let l;try{if(!n)throw new Error("No data");l=JSON.parse(n)}catch{}const o=localStorage.getItem(F);if(o&&Number(o)&&Number(o)<Date.now()){console.log("Expired, fetching new data");const a=await Y();return a?(localStorage.setItem(T,JSON.stringify(a)),localStorage.setItem(F,String(Date.now()+432e5)),a):l}return l||(l=await Y(),l&&(localStorage.setItem(T,JSON.stringify(l)),localStorage.setItem(F,String(Date.now()+432e5))),l)}async function H(){const n=await fetch(Ve+"wiki/Module:NavLevel/levels?action=raw");if(!n.ok)return null;const o=(await n.text()).replace(/^return\s+/,"").replace(/\{/g,"[").replace(/\}/g,"]").replace(/\-\-.*?\n/g,"");try{return JSON.parse(o)}catch{return null}}async function be(){let n=mw.storage.getObject(U);return n||(n=await H(),mw.storage.setObject(U,n,43200),n)}function Se(n){mw.storage.setObject(ue,n)}function Ee(){const n=mw.storage.getObject(ue);return n||null}function ce(n){return mw.config.get("wgPageName").replace(/_/g," ")===n.replace(/_/g," ")}async function Ne(){const n=await H(),l=await Y();return n&&mw.storage.setObject(U,n,43200),l&&(localStorage.setItem(T,JSON.stringify(l)),localStorage.setItem(F,String(Date.now()+432e5))),{levels:n,data:l}}const pe=Object.freeze(Object.defineProperty({__proto__:null,fetchData:Y,fetchLevels:H,getData:we,getValidLevels:be,hotPurge:Ne,isCurrentPage:ce,loadOptionsFromStorage:Ee,saveOptionsToStorage:Se},Symbol.toStringTag,{value:"Module"}));let c;({convByVar:c}=require("ext.gadget.HanAssist"));const P=new Map;function Le(n){for(const l of n){const o=l.textContent.trim(),a=decodeURI(l.href.split("wiki/")[1]);P.set(a,o),P.set(o,o),P.set(a.replace(/_/g," "),o),P.set(o.replace(/_/g," "),o)}}function $e(n){return P.get(n)||n}function ke(n){return c({hans:"å…±åˆ›",hant:"å…±å‰µ"})}const ve=mw.loader.getState("ext.gadget.separate-space")==="ready";function q(n){return ve?" "+n+" ":n}function K(n){return ve?n+" ":n}const xe=Vue.defineComponent,Ce=Vue.renderList,De=Vue.Fragment,W=Vue.openBlock,G=Vue.createElementBlock,Q=Vue.unref,Ie=Vue.toDisplayString,Oe=Vue.normalizeClass,Pe=Vue.createElementVNode,Ae={class:"hlist"},Be=["href","title"],Z=xe({__name:"HList",props:{levels:{}},setup(n){const l=ce;function o(a){return $e(a.page)}return(a,y)=>(W(),G("ul",Ae,[(W(!0),G(De,null,Ce(n.levels,p=>(W(),G("li",null,[Pe("a",{href:Q(l)(p.page)?void 0:`/wiki/${encodeURI(p.page)}`,title:`${p.type==="å®˜æ–¹"?"Lv.":"Co."}${p.num} ${o(p)} ${"â˜…".repeat(p.stars)}
${p.award==="crown"?"3ğŸ‘‘ ":p.award==="present"?"10ğŸ ":""}${p.dia}ğŸ’
${p.inVer}(${p.inDate||"????-??-??"})${Q(c)({hans:"ç‰ˆæœ¬åŠ å…¥æ¸¸æˆ",hant:"ç‰ˆæœ¬åŠ å…¥éŠæˆ²"})}`,class:Oe(Q(l)(p.page)?"mw-selflink selflink":"")},Ie(o(p)),11,Be)]))),256))]))}}),Re=Vue.useModel,de=Vue.mergeModels,Me=Vue.defineComponent,Te=Vue.renderList,me=Vue.Fragment,z=Vue.openBlock,J=Vue.createElementBlock,Fe=Vue.toDisplayString,Ye=Vue.createElementVNode,qe=Vue.createCommentVNode,Ke={class:"priority-sort",role:"list","aria-label":"ä¼˜å…ˆçº§æ’åº"},ze=["onClick","onKeydown","aria-label"],Je={key:0,class:"priority-arrow","aria-hidden":"true"};Vue.computed;const ee=Vue.nextTick,Xe=Me({__name:"PrioritySort",props:de({labelMap:{default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:de(["update:modelValue"],["update:modelValue"]),setup(n,{emit:l}){const o=n,a=Re(n,"modelValue"),y=l,p=d=>o.labelMap[d]||d,A=(d,u)=>{k(d.currentTarget,u),y("update:modelValue",a.value)},b=(d,u)=>{const V=d.currentTarget;switch(d.key){case"Enter":case" ":d.preventDefault(),k(V,u);break;case"ArrowLeft":d.preventDefault(),x(V,u);break;case"ArrowRight":d.preventDefault(),m(V,u);break}y("update:modelValue",a.value)},k=(d,u)=>{if(u<=0)return;const[V]=a.value.splice(u,1);a.value.unshift(V);const v=d.parentElement;ee(()=>{Array.from(v?.querySelectorAll(".priority-chip")||[])[0]?.focus()})},x=(d,u)=>{if(u<=0)return;const V=d.parentElement,v=a.value[u];a.value[u]=a.value[u-1],a.value[u-1]=v,ee(()=>{Array.from(V?.querySelectorAll(".priority-chip")||[])[u-1]?.focus()})},m=(d,u)=>{if(u>=a.value.length-1)return;const V=d.parentElement,v=a.value[u];a.value[u]=a.value[u+1],a.value[u+1]=v,ee(()=>{Array.from(V?.querySelectorAll(".priority-chip")||[])[u+1]?.focus()})};return(d,u)=>(z(),J("div",Ke,[(z(!0),J(me,null,Te(a.value,(V,v)=>(z(),J(me,{key:V},[Ye("button",{type:"button",class:"priority-chip",onClick:g=>A(g,v),onKeydown:g=>b(g,v),"aria-label":`${p(V)}ï¼Œç‚¹å‡»è®¾ä¸ºç¬¬ä¸€ä¼˜å…ˆçº§ï¼Œå·¦å³ç®­å¤´é”®ç§»åŠ¨ä¸€ä½`},Fe(p(V)),41,ze),v<a.value.length-1?(z(),J("span",Je,">")):qe("",!0)],64))),128))]))}}),ge=(n,l)=>{const o=n.__vccOpts||n;for(const[a,y]of l)o[a]=y;return o},je=ge(Xe,[["__scopeId","data-v-ca757e80"]]),Ue=Vue.defineComponent,w=Vue.createElementVNode,f=Vue.unref,S=Vue.toDisplayString,fe=Vue.withKeys,L=Vue.createTextVNode,D=Vue.renderList,E=Vue.Fragment,h=Vue.openBlock,_=Vue.createElementBlock,te=Vue.withCtx,C=Vue.createVNode,ne=Vue.normalizeClass,X=Vue.createCommentVNode,He={class:"navbox-above navbox-cell navbox-sole-row"},We={class:"navbox-above navbox-cell navbox-sole-row navlevel-nav"},Ge={class:"navlevel-radio-group"},Qe={class:"navlevel-radio-group"},Ze={class:"navlevel-radio-group"},et={class:"navlevel-radio-group"},tt={class:"navbox-group navbox-cell"},nt=["title"],rt={key:0,class:"navbox-group navbox-cell"},at=["title"],ot={key:1,class:"navbox navbox-list navbox-cell navbox-level-1 mobileplainbox"},st={key:0,class:"navbox-group navbox-cell"},lt=["title"],re=Codex.CdxRadio,it=Vue.onMounted,N=Vue.ref,ut=ge(Ue({__name:"Main",props:{recvData:{},recvLevels:{},preserveElements:{},preserveBeforeElements:{},titleElement:{}},setup(n){const l=pe,{saveOptionsToStorage:o,loadOptionsFromStorage:a}=l,y=n,p=N(y.recvData),A=N(y.recvLevels),b={type:c({hans:"ç±»å‹",hant:"é¡å‹"}),era:c({hans:"æ—¶æœŸ",hant:"æ™‚æœŸ"}),stars:c({hans:"æ˜Ÿæ•°",hant:"æ˜Ÿæ•¸"}),version:c({hans:"ç‰ˆæœ¬",hant:"ç‰ˆæœ¬"}),present:c({hans:"å¥–åŠ±æ–¹å¼",hant:"çå‹µæ–¹å¼"}),year:c({hans:"å¹´ä»½",hant:"å¹´ä»½"}),none:c({hans:"æ— ",hant:"ç„¡"})},k={num:c({hans:"ç¼–å·",hant:"ç·¨è™Ÿ"}),name:c({hans:"åç§°",hant:"åç¨±"}),stars:c({hans:"æ˜Ÿæ•°",hant:"æ˜Ÿæ•¸"}),date:c({hans:"æ—¥æœŸ",hant:"æ—¥æœŸ"}),default:c({hans:"é»˜è®¤",hant:"é è¨­"})},x={asc:"å‡åº",desc:"é™åº"},m=a();function d(t){return t in b}function u(t){return t in k}function V(t){return t in x}const v=N(m?.grouping1&&d(m.grouping1)?m.grouping1:"type"),g=N(m?.grouping2&&d(m.grouping2)?m.grouping2:"stars"),j=N(m?.direction&&V(m.direction)?m.direction:"asc"),he=["default","num","date","name","stars"],B=N(m?.sortingPriority&&Array.isArray(m.sortingPriority)&&m.sortingPriority.every(t=>u(t))&&m.sortingPriority.length===he.length?m.sortingPriority:he),R=N(null),M=N(null),I=N({});it(()=>{if(M.value&&y.preserveBeforeElements?.length){let t=M.value;y.preserveBeforeElements.forEach(e=>{e&&t.parentNode&&(t.parentNode.insertBefore(e,t),t=e)})}if(R.value&&y.preserveElements?.length){let t=R.value;y.preserveElements.forEach(e=>{e&&t&&t.parentNode&&(t.parentNode.insertBefore(e,t.nextSibling),t=e)})}R.value&&R.value.remove(),M.value&&M.value.remove(),O()});function pt(t){return dt[t]||(()=>0)}function _e(t,e){for(let s=0;s<B.value.length;s++){const r=pt(B.value[s])(t,e);if(r!==0)return r*(j.value==="asc"?1:-1)}return 0}const vt={era(t){return[{group:"è¾£æ¤’",list:t.filter(e=>e.type==="å®˜æ–¹"&&e.num<=7)},{group:c({hans:"çŒè±¹",hant:"çµè±¹"}),list:t.filter(e=>e.type==="å®˜æ–¹"&&e.num>7&&e.num<=94)},{group:c({hans:"ç±³éº¦",hant:"ç±³éº¥"}),list:t.filter(e=>e.type==="å…±åˆ›"||e.type==="å®˜æ–¹"&&e.num>94)}]},version(t){const e=new Set;return t.forEach(r=>e.add(r.inVer.substring(0,1))),e.delete("3"),Array.from(e).sort((r,i)=>r.localeCompare(i)).map(r=>({group:r==="2"?"2.x / 3.x":r+".x",list:r==="2"?t.filter(i=>i.inVer.startsWith("2")||i.inVer.startsWith("3")):t.filter(i=>i.inVer.startsWith(r))}))},type(t){return[{group:"å®˜æ–¹",list:t.filter(e=>e.type==="å®˜æ–¹")},{group:ke(),list:t.filter(e=>e.type==="å…±åˆ›")}]},stars(t){const e=new Set;return t.forEach(r=>e.add(r.stars)),Array.from(e).sort((r,i)=>r-i).map(r=>({group:K(r.toString())+"æ˜Ÿ",list:t.filter(i=>i.stars===r)}))},year(t){const e=new Set;t.forEach(i=>e.add(i.inDate.substring(0,4)));const s=new Set;return e.forEach(i=>{i.trim()===""&&s.add(i)}),s.forEach(i=>e.delete(i)),Array.from(e).sort((i,ie)=>parseInt(i)-parseInt(ie)).map(i=>({group:i,list:t.filter(ie=>ie.inDate.startsWith(i))}))},present(t){const e=t.filter(r=>!["crown","present","none"].includes(r.award)),s=[{group:"çš‡å† ",list:t.filter(r=>r.award==="crown")},{group:"ç¥ç§˜ç®±",list:t.filter(r=>r.award==="present")},{group:c({hans:"æ— ",hant:"ç„¡"}),list:t.filter(r=>r.award==="none")}];return e.length>0&&s.push({group:c({hans:"æœªçŸ¥",hant:"æœªçŸ¥"}),list:e}),s},none(t){return t}},dt={num:(t,e)=>t.type===e.type?t.num-e.num:t.type==="å®˜æ–¹"?-1:1,name:(t,e)=>t.name.localeCompare(e.name),stars:(t,e)=>t.stars-e.stars,date:(t,e)=>t.inDate.localeCompare(e.inDate),default:(t,e)=>{const s=A.value;return s.indexOf(t.page)-s.indexOf(e.page)}};function mt(t,e){return vt[e](t)}function ae(t,e){return mt(t,e).map(s=>(s.list=s.list.sort(_e),s))}let ye=0;function O(){ye=0,v.value===g.value&&g.value!=="none"&&(g.value=v.value==="stars"?"type":"stars"),v.value==="none"&&(g.value="none"),o({grouping1:v.value,grouping2:g.value,sortingPriority:B.value,direction:j.value});const t=p.value;if(v.value==="none"){I.value=[...t].sort(_e);return}else g.value==="none"?I.value=ae(t,v.value):I.value=ae(t,v.value).map(e=>(e.list=ae(e.list,g.value),e))}function oe(){return++ye%2?"navbox-odd":"navbox-even"}async function se(){const{levels:t,data:e}=await l.hotPurge();t?A.value=t:mw.notify(c({hans:"è·å–åˆæ³•å…³å¡åˆ—è¡¨å¤±è´¥ã€‚",hant:"ç²å–åˆæ³•é—œå¡åˆ—è¡¨å¤±æ•—ã€‚"}),{type:"error"}),e?p.value=e:mw.notify(c({hans:`è·å–å…³å¡${q("Cargo")}æ•°æ®å¤±è´¥ã€‚`,hant:`ç²å–é—œå¡${q("Cargo")}æ•¸æ“šå¤±æ•—ã€‚`}),{type:"error"}),O()}const le=c({hans:"å…³",hant:"é—œ"});return(t,e)=>(h(),_(E,null,[w("div",{ref_key:"markerBefore",ref:M},null,512),w("div",He,[L(S(f(c)({hans:`æœ¬æ™ºèƒ½æ’åºä¸ºå®éªŒæ€§åŠŸèƒ½ã€‚å½“å‰è·å–åˆ°${f(q)(p.value.length)}ä¸ªå…³å¡çš„æ•°æ®ã€‚`,hant:`æœ¬æ™ºèƒ½æ’åºç‚ºå¯¦é©—æ€§åŠŸèƒ½ã€‚ç•¶å‰ç²å–åˆ°${f(q)(p.value.length)}å€‹é—œå¡çš„æ•¸æ“šã€‚`}))+" ï¼ˆ",1),w("a",{onClick:se,onKeydown:[fe(se,["enter"]),fe(se,["space"])],role:"button",tabindex:"0"},S(f(c)({hans:"æ¸…é™¤ç¼“å­˜",hant:"æ¸…é™¤å¿«å–"})),33),e[5]||(e[5]=L("ï¼‰ ",-1))]),w("div",We,[w("div",Ge,[L(S(f(c)({hans:"ä¸€çº§åˆ†ç»„ï¼š",hant:"ä¸€ç´šåˆ†çµ„ï¼š"}))+" ",1),(h(),_(E,null,D(b,(s,r)=>C(f(re),{"model-value":v.value,"onUpdate:modelValue":[e[0]||(e[0]=i=>v.value=i),O],"input-value":r,name:"grouping1",inline:!0},{default:te(()=>[L(S(b[r]),1)]),_:2},1032,["model-value","input-value"])),64))]),w("div",Qe,[L(S(f(c)({hans:"äºŒçº§åˆ†ç»„ï¼š",hant:"äºŒç´šåˆ†çµ„ï¼š"}))+" ",1),(h(),_(E,null,D(b,(s,r)=>C(f(re),{"model-value":g.value,"onUpdate:modelValue":[e[1]||(e[1]=i=>g.value=i),O],"input-value":r,name:"grouping2",inline:!0,disabled:r!==v.value==(v.value==="none")},{default:te(()=>[L(S(b[r]),1)]),_:2},1032,["model-value","input-value","disabled"])),64))]),w("div",Ze,[L(S(f(c)({hans:"æ’åºï¼š",hant:"æ’åºï¼š"}))+" ",1),C(je,{modelValue:B.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>B.value=s),e[3]||(e[3]=s=>O())],"label-map":k},null,8,["modelValue"])]),w("div",et,[(h(),_(E,null,D(x,(s,r)=>C(f(re),{name:"direction","input-value":r,"model-value":j.value,"onUpdate:modelValue":[e[4]||(e[4]=i=>j.value=i),O],inline:!0},{default:te(()=>[L(S(x[r]),1)]),_:2},1032,["input-value","model-value"])),64))])]),v.value==="none"?(h(),_("div",{key:0,class:ne("navbox-list navbox-sole-row "+oe())},[C(Z,{levels:I.value},null,8,["levels"])],2)):(h(),_(E,{key:1},[g.value==="none"?(h(!0),_(E,{key:0},D(I.value,s=>(h(),_(E,null,[w("div",tt,[w("span",{class:"navbox-group-flex-inner",title:`${f(K)(s.list.length)}${f(le)}`},S(s.group),9,nt)]),w("div",{class:ne("navbox-list navbox-cell "+oe())},[C(Z,{levels:s.list},null,8,["levels"])],2)],64))),256)):(h(!0),_(E,{key:1},D(I.value,s=>(h(),_(E,null,[s.list.length>0?(h(),_("div",rt,[w("span",{class:"navbox-group-flex-inner",title:`${f(K)(s.list.reduce((r,i)=>r+i.list.length,0))}${f(le)}`},S(s.group),9,at)])):X("",!0),s.list.length>0?(h(),_("div",ot,[(h(!0),_(E,null,D(s.list,r=>(h(),_(E,null,[r.list.length>0?(h(),_("div",st,[w("span",{class:"navbox-group-flex-inner",title:`${f(K)(r.list.length)}${f(le)}`},S(r.group),9,lt)])):X("",!0),r.list.length>0?(h(),_("div",{key:1,class:ne("navbox-list navbox-cell "+oe())},[C(Z,{levels:r.list},null,8,["levels"])],2)):X("",!0)],64))),256))])):X("",!0)],64))),256))],64)),w("div",{ref_key:"mark",ref:R},null,512)],64))}}),[["__scopeId","data-v-a128930d"]]);async function ct(){const n=pe,{getData:l,getValidLevels:o}=n;try{const[a,y]=await Promise.all([l(),o()]);if(!a||!y){mw.notify("Failed to fetch qualified data",{type:"error"});return}const p=document.querySelectorAll(".navlevel-sortable:not(.navlevel-sortable-processed)");$.each(p,async(A,b)=>{Le(Array.from(b.querySelectorAll("a[href]")));const k=Array.from(b.querySelectorAll(".navlevel-sortable-preserve")),x=Array.from(b.querySelectorAll(".navlevel-sortable-preserve-before"));[...k,...x].forEach(u=>{u.parentNode&&u.parentNode.removeChild(u)});const m=$(b);m.empty(),m.addClass("navlevel-sortable-processed"),Vue.createApp(ut,{recvData:a,recvLevels:y,preserveElements:k,preserveBeforeElements:x,titleElement:b.querySelector(".navbox-title")||document.createElement("div")}).mount(b)})}catch(a){console.error("Failed to initialize NavLevel:",a),mw.notify("Failed to initialize NavLevel: "+a.message,{type:"error"})}}mw.hook("wikipage.content").add(ct)})();

  
});

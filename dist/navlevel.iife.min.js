(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".priority-sort[data-v-ca757e80]{display:flex;align-items:center;gap:var(--spacing-50, 8px);flex-wrap:wrap}.priority-chip[data-v-ca757e80]{display:inline-flex;align-items:center;padding:var(--spacing-25, 4px) var(--spacing-25, 4px);background-color:var(--background-color-base, #f8f9fa);border:1px solid var(--border-color-subtle, #c8ccd1);border-radius:var(--border-radius-base, 4px);color:var(--color-base, #202122);font-size:var(--font-size-small, .8125rem);font-weight:var(--font-weight-normal, 400);font-family:var(--font-family-system-sans, sans-serif);cursor:pointer;transition:all var(--transition-duration-base, .1s) var(--transition-timing-function-ease-in-out, ease-in-out);white-space:nowrap;-webkit-user-select:none;user-select:none}.priority-chip[data-v-ca757e80]:hover{background-color:var(--background-color-interactive-subtle, #eaecf0);border-color:var(--border-color-interactive, #72777d)}.priority-chip[data-v-ca757e80]:focus{outline:2px solid var(--color-progressive, #36c);outline-offset:2px}.priority-chip[data-v-ca757e80]:active{background-color:var(--background-color-interactive, #eaf3ff);border-color:var(--color-progressive, #36c)}.priority-arrow[data-v-ca757e80]{color:var(--color-subtle, #54595d);font-weight:var(--font-weight-bold, 700);margin:0 var(--spacing-25, 4px)}@media(max-width:768px){.priority-sort[data-v-ca757e80]{gap:var(--spacing-35, 6px)}.priority-arrow[data-v-ca757e80]{margin:0 var(--spacing-15, 2px)}}.navlevel-nav[data-v-9a4844d2]{display:flex;flex-direction:row;flex-wrap:wrap;gap:1em}.navlevel-radio-group[data-v-9a4844d2]{display:flex;flex-direction:row;align-items:center;flex-wrap:wrap;padding:2px}a[role=button][data-v-9a4844d2]{cursor:pointer}.navlevel-sortable .navbox-title{z-index:1}")),document.head.appendChild(a)}}catch(r){console.error("vite-plugin-css-injected-by-js",r)}})();

/// <reference types="types-mediawiki" />
/// <reference types="types-mediawiki-api" />
mw.loader.using(["vue", "@wikimedia/codex", "ext.gadget.HanAssist"], function(require) {
  const vueModule = require("vue");
  const codexModule = require("@wikimedia/codex");
  
  
  const Vue = vueModule;
  const Codex = codexModule;
  
  // 原始代码
  (function(){"use strict";const F="rswiki:NavLevel-data",H="rswiki:NavLevel-levels",Y="rswiki:NavLevel-expiry",ie="rswiki:NavLevel-options",ye="https://rs.miraheze.org/";async function K(){const e=await new mw.Api().get({action:"cargoquery",formatversion:2,tables:"Level",fields:"Level.name_zh = name, Level.num = num, Level._pageName = page, Level.type = type, Level.stars = stars, Level.first_came_version = inVer, Level.removed_version = remVer, Level.restored_version = resVer",where:"Level.stars IS NOT NULL AND(Level.type = '官方' OR Level.type = '共创') AND Level._pageName NOT LIKE '%（旧）'",limit:500});if(!e.cargoquery)return null;const a=e.cargoquery.map(i=>({...i.title,num:Number(i.title.num),stars:Number(i.title.stars)}));return a.length<210?null:a}async function Ve(){const e=localStorage.getItem(F);let a;try{if(!e)throw new Error("No data");a=JSON.parse(e)}catch{}const i=localStorage.getItem(Y);if(i&&Number(i)&&Number(i)<Date.now()){console.log("Expired, fetching new data");const n=await K();return n?(localStorage.setItem(F,JSON.stringify(n)),localStorage.setItem(Y,String(Date.now()+432e5)),n):a}return a||(a=await K(),a&&(localStorage.setItem(F,JSON.stringify(a)),localStorage.setItem(Y,String(Date.now()+432e5))),a)}async function G(){const e=await fetch(ye+"wiki/Module:NavLevel/levels?action=raw");if(!e.ok)return null;const i=(await e.text()).replace(/^return\s+/,"").replace(/\{/g,"[").replace(/\}/g,"]").replace(/\-\-.*?\n/g,"");try{return JSON.parse(i)}catch{return null}}async function be(){let e=mw.storage.getObject(H);return e||(e=await G(),mw.storage.setObject(H,e,43200),e)}function we(e){mw.storage.setObject(ie,e)}function Se(){const e=mw.storage.getObject(ie);return e||null}function ue(e){return mw.config.get("wgPageName").replace(/_/g," ")===e.replace(/_/g," ")}async function Ee(){const e=await G(),a=await K();return e&&mw.storage.setObject(H,e,43200),a&&(localStorage.setItem(F,JSON.stringify(a)),localStorage.setItem(Y,String(Date.now()+432e5))),{levels:e,data:a}}const ce=Object.freeze(Object.defineProperty({__proto__:null,fetchData:K,fetchLevels:G,getData:Ve,getValidLevels:be,hotPurge:Ee,isCurrentPage:ue,loadOptionsFromStorage:Se,saveOptionsToStorage:we},Symbol.toStringTag,{value:"Module"}));let v;({convByVar:v}=require("ext.gadget.HanAssist"));const B=new Map;function Ne(e){for(const a of e){const i=a.textContent.trim(),n=decodeURI(a.href.split("wiki/")[1]);B.set(n,i),B.set(i,i),B.set(n.replace(/_/g," "),i),B.set(i.replace(/_/g," "),i)}}function Le(e){return B.get(e)||e}function ke(e){return v({hans:"共创",hant:"共創"})}const xe=Vue.defineComponent,$e=Vue.renderList,Ce=Vue.Fragment,W=Vue.openBlock,Q=Vue.createElementBlock,Z=Vue.unref,De=Vue.toDisplayString,Oe=Vue.normalizeClass,Ie=Vue.createElementVNode,Pe={class:"hlist"},Ae=["href","title"],ee=xe({__name:"HList",props:{levels:{}},setup(e){const a=ue;function i(n){return Le(n.page)}return(n,h)=>(W(),Q("ul",Pe,[(W(!0),Q(Ce,null,$e(e.levels,d=>(W(),Q("li",null,[Ie("a",{href:Z(a)(d.page)?void 0:`/wiki/${encodeURI(d.page)}`,title:`${d.type==="官方"?"Lv.":"Co."}${d.num} ${i(d)} ${"★".repeat(d.stars)}
${d.inVer}${Z(v)({hans:"版本加入游戏",hant:"版本加入遊戲"})}`,class:Oe(Z(a)(d.page)?"mw-selflink selflink":"")},De(i(d)),11,Ae)]))),256))]))}}),Be=Vue.useModel,ve=Vue.mergeModels,Re=Vue.defineComponent,Me=Vue.renderList,pe=Vue.Fragment,z=Vue.openBlock,J=Vue.createElementBlock,Te=Vue.toDisplayString,qe=Vue.createElementVNode,Fe=Vue.createCommentVNode,Ye={class:"priority-sort",role:"list","aria-label":"优先级排序"},Ke=["onClick","onKeydown","aria-label"],ze={key:0,class:"priority-arrow","aria-hidden":"true"};Vue.computed;const te=Vue.nextTick,Je=Re({__name:"PrioritySort",props:ve({labelMap:{default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:ve(["update:modelValue"],["update:modelValue"]),setup(e,{emit:a}){const i=e,n=Be(e,"modelValue"),h=a,d=p=>i.labelMap[p]||p,R=(p,l)=>{C(p.currentTarget,l),h("update:modelValue",n.value)},b=(p,l)=>{const y=p.currentTarget;switch(p.key){case"Enter":case" ":p.preventDefault(),C(y,l);break;case"ArrowLeft":p.preventDefault(),D(y,l);break;case"ArrowRight":p.preventDefault(),m(y,l);break}h("update:modelValue",n.value)},C=(p,l)=>{if(l<=0)return;const[y]=n.value.splice(l,1);n.value.unshift(y);const c=p.parentElement;te(()=>{Array.from(c?.querySelectorAll(".priority-chip")||[])[0]?.focus()})},D=(p,l)=>{if(l<=0)return;const y=p.parentElement,c=n.value[l];n.value[l]=n.value[l-1],n.value[l-1]=c,te(()=>{Array.from(y?.querySelectorAll(".priority-chip")||[])[l-1]?.focus()})},m=(p,l)=>{if(l>=n.value.length-1)return;const y=p.parentElement,c=n.value[l];n.value[l]=n.value[l+1],n.value[l+1]=c,te(()=>{Array.from(y?.querySelectorAll(".priority-chip")||[])[l+1]?.focus()})};return(p,l)=>(z(),J("div",Ye,[(z(!0),J(pe,null,Me(n.value,(y,c)=>(z(),J(pe,{key:y},[qe("button",{type:"button",class:"priority-chip",onClick:f=>R(f,c),onKeydown:f=>b(f,c),"aria-label":`${d(y)}，点击设为第一优先级，左右箭头键移动一位`},Te(d(y)),41,Ke),c<n.value.length-1?(z(),J("span",ze,">")):Fe("",!0)],64))),128))]))}}),de=(e,a)=>{const i=e.__vccOpts||e;for(const[n,h]of a)i[n]=h;return i},Xe=de(Je,[["__scopeId","data-v-ca757e80"]]),me=mw.loader.getState("ext.gadget.separate-space")==="ready";function X(e){return me?" "+e+" ":e}function je(e){return me?e+" ":e}const Ue=Vue.defineComponent,V=Vue.createElementVNode,E=Vue.unref,w=Vue.toDisplayString,fe=Vue.withKeys,x=Vue.createTextVNode,I=Vue.renderList,S=Vue.Fragment,g=Vue.openBlock,_=Vue.createElementBlock,ne=Vue.withCtx,O=Vue.createVNode,oe=Vue.normalizeClass,j=Vue.createCommentVNode,He={class:"navbox-above navbox-cell navbox-sole-row"},Ge={class:"navbox-above navbox-cell navbox-sole-row navlevel-nav"},We={class:"navlevel-radio-group"},Qe={class:"navlevel-radio-group"},Ze={class:"navlevel-radio-group"},et={class:"navlevel-radio-group"},tt={class:"navbox-group navbox-cell"},nt={class:"navbox-group-flex-inner"},ot={key:0,class:"navbox-group navbox-cell"},rt={class:"navbox-group-flex-inner"},at={key:1,class:"navbox navbox-list navbox-cell navbox-level-1 mobileplainbox"},st={key:0,class:"navbox-group navbox-cell"},lt={class:"navbox-group-flex-inner"},re=Codex.CdxRadio;Vue.computed;const it=Vue.onMounted,L=Vue.ref,ut=de(Ue({__name:"Main",props:{recvData:{},recvLevels:{},preserveElements:{},preserveBeforeElements:{},titleElement:{}},setup(e){const a=ce,{saveOptionsToStorage:i,loadOptionsFromStorage:n}=a,h=e,d=L(h.recvData),R=L(h.recvLevels),b={type:v({hans:"类型",hant:"類型"}),era:v({hans:"时期",hant:"時期"}),stars:v({hans:"星数",hant:"星數"}),version:v({hans:"版本",hant:"版本"}),none:v({hans:"无",hant:"無"})},C={num:v({hans:"编号",hant:"編號"}),name:v({hans:"名称",hant:"名稱"}),stars:v({hans:"星数",hant:"星數"}),default:v({hans:"默认",hant:"預設"})},D={asc:"升序",desc:"降序"},m=n();function p(t){return t in b}function l(t){return t in C}function y(t){return t in D}const c=L(m?.grouping1&&p(m.grouping1)?m.grouping1:"type"),f=L(m?.grouping2&&p(m.grouping2)?m.grouping2:"stars"),U=L(m?.direction&&y(m.direction)?m.direction:"asc"),M=L(m?.sortingPriority&&Array.isArray(m.sortingPriority)&&m.sortingPriority.every(t=>l(t))?m.sortingPriority:["default","num","name","stars"]),T=L(null),q=L(null),P=L({});it(()=>{if(q.value&&h.preserveBeforeElements?.length){let t=q.value;h.preserveBeforeElements.forEach(o=>{o&&t.parentNode&&(t.parentNode.insertBefore(o,t),t=o)})}if(T.value&&h.preserveElements?.length){let t=T.value;h.preserveElements.forEach(o=>{o&&t&&t.parentNode&&(t.parentNode.insertBefore(o,t.nextSibling),t=o)})}T.value&&T.value.remove(),q.value&&q.value.remove(),A()});function vt(t){const o=R.value;switch(t){case"num":return(r,u)=>r.type===u.type?r.num-u.num:r.type==="官方"?-1:1;case"name":return(r,u)=>r.name.localeCompare(u.name);case"stars":return(r,u)=>r.stars-u.stars;case"default":return(r,u)=>o.indexOf(r.page)-o.indexOf(u.page);default:return()=>0}}function ge(t,o){for(let r=0;r<M.value.length;r++){const u=vt(M.value[r])(t,o);if(u!==0)return u*(U.value==="asc"?1:-1)}return 0}function pt(t,o){switch(o){case"era":return[{group:"辣椒",list:t.filter(s=>s.type==="官方"&&s.num<=7)},{group:v({hans:"猎豹",hant:"獵豹"}),list:t.filter(s=>s.type==="官方"&&s.num>7&&s.num<=94)},{group:v({hans:"米麦",hant:"米麥"}),list:t.filter(s=>s.type==="共创"||s.type==="官方"&&s.num>94)}];case"version":const r=new Set;return t.forEach(s=>r.add(s.inVer.substring(0,1))),r.delete("3"),Array.from(r).sort((s,N)=>s.localeCompare(N)).map(s=>({group:s==="2"?"2.x / 3.x":s+".x",list:s==="2"?t.filter(N=>N.inVer.startsWith("2")||N.inVer.startsWith("3")):t.filter(N=>N.inVer.startsWith(s))}));case"type":const k=[];return k.push({group:"官方",list:t.filter(s=>s.type==="官方")}),k.push({group:ke(),list:t.filter(s=>s.type==="共创")}),k;case"stars":const he=new Set;return t.forEach(s=>he.add(s.stars)),Array.from(he).sort((s,N)=>s-N).map(s=>({group:je(s.toString())+"星",list:t.filter(N=>N.stars===s)}));default:return t}}function ae(t,o){return pt(t,o).map(r=>(r.list=r.list.sort(ge),r))}let _e=0;function A(){_e=0,c.value===f.value&&f.value!=="none"&&(f.value=c.value==="stars"?"type":"stars"),c.value==="none"&&(f.value="none"),i({grouping1:c.value,grouping2:f.value,sortingPriority:M.value,direction:U.value});const t=d.value;if(c.value==="none"){P.value=[...t].sort(ge);return}else f.value==="none"?P.value=ae(t,c.value):P.value=ae(t,c.value).map(o=>(o.list=ae(o.list,f.value),o))}function se(){return++_e%2?"navbox-odd":"navbox-even"}async function le(){const{levels:t,data:o}=await a.hotPurge();t?R.value=t:mw.notify(v({hans:"获取合法关卡列表失败。",hant:"獲取合法關卡列表失敗。"}),{type:"error"}),o?d.value=o:mw.notify(v({hans:`获取关卡${X("Cargo")}数据失败。`,hant:`獲取關卡${X("Cargo")}數據失敗。`}),{type:"error"}),A()}return(t,o)=>(g(),_(S,null,[V("div",{ref_key:"markerBefore",ref:q},null,512),V("div",He,[x(w(E(v)({hans:`本智能排序为实验性功能。当前获取到${E(X)(d.value.length)}个关卡的数据。`,hant:`本智能排序為實驗性功能。當前獲取到${E(X)(d.value.length)}個關卡的數據。`}))+" （",1),V("a",{onClick:le,onKeydown:[fe(le,["enter"]),fe(le,["space"])],role:"button",tabindex:"0"},w(E(v)({hans:"清除缓存",hant:"清除快取"})),33),o[5]||(o[5]=x("） ",-1))]),V("div",Ge,[V("div",We,[x(w(E(v)({hans:"一级分组：",hant:"一級分組："}))+" ",1),(g(),_(S,null,I(b,(r,u)=>O(E(re),{"model-value":c.value,"onUpdate:modelValue":[o[0]||(o[0]=k=>c.value=k),A],"input-value":u,name:"grouping1",inline:!0},{default:ne(()=>[x(w(b[u]),1)]),_:2},1032,["model-value","input-value"])),64))]),V("div",Qe,[x(w(E(v)({hans:"二级分组：",hant:"二級分組："}))+" ",1),(g(),_(S,null,I(b,(r,u)=>O(E(re),{"model-value":f.value,"onUpdate:modelValue":[o[1]||(o[1]=k=>f.value=k),A],"input-value":u,name:"grouping2",inline:!0,disabled:u!==c.value==(c.value==="none")},{default:ne(()=>[x(w(b[u]),1)]),_:2},1032,["model-value","input-value","disabled"])),64))]),V("div",Ze,[x(w(E(v)({hans:"排序：",hant:"排序："}))+" ",1),O(Xe,{modelValue:M.value,"onUpdate:modelValue":[o[2]||(o[2]=r=>M.value=r),o[3]||(o[3]=r=>A())],"label-map":C},null,8,["modelValue"])]),V("div",et,[(g(),_(S,null,I(D,(r,u)=>O(E(re),{name:"direction","input-value":u,"model-value":U.value,"onUpdate:modelValue":[o[4]||(o[4]=k=>U.value=k),A],inline:!0},{default:ne(()=>[x(w(D[u]),1)]),_:2},1032,["input-value","model-value"])),64))])]),c.value==="none"?(g(),_("div",{key:0,class:oe("navbox-list navbox-sole-row "+se())},[O(ee,{levels:P.value},null,8,["levels"])],2)):(g(),_(S,{key:1},[f.value==="none"?(g(!0),_(S,{key:0},I(P.value,r=>(g(),_(S,null,[V("div",tt,[V("span",nt,w(r.group),1)]),V("div",{class:oe("navbox-list navbox-cell "+se())},[O(ee,{levels:r.list},null,8,["levels"])],2)],64))),256)):(g(!0),_(S,{key:1},I(P.value,r=>(g(),_(S,null,[r.list.length>0?(g(),_("div",ot,[V("span",rt,w(r.group),1)])):j("",!0),r.list.length>0?(g(),_("div",at,[(g(!0),_(S,null,I(r.list,u=>(g(),_(S,null,[u.list.length>0?(g(),_("div",st,[V("span",lt,w(u.group),1)])):j("",!0),u.list.length>0?(g(),_("div",{key:1,class:oe("navbox-list navbox-cell "+se())},[O(ee,{levels:u.list},null,8,["levels"])],2)):j("",!0)],64))),256))])):j("",!0)],64))),256))],64)),V("div",{ref_key:"mark",ref:T},null,512)],64))}}),[["__scopeId","data-v-9a4844d2"]]);async function ct(){const e=ce,{getData:a,getValidLevels:i}=e;try{const[n,h]=await Promise.all([a(),i()]);if(!n||!h){mw.notify("Failed to fetch qualified data",{type:"error"});return}const d=document.querySelectorAll(".navlevel-sortable:not(.navlevel-sortable-processed)");$.each(d,async(R,b)=>{Ne(Array.from(b.querySelectorAll("a[href]")));const C=Array.from(b.querySelectorAll(".navlevel-sortable-preserve")),D=Array.from(b.querySelectorAll(".navlevel-sortable-preserve-before"));[...C,...D].forEach(l=>{l.parentNode&&l.parentNode.removeChild(l)});const m=$(b);m.empty(),m.addClass("navlevel-sortable-processed"),Vue.createApp(ut,{recvData:n,recvLevels:h,preserveElements:C,preserveBeforeElements:D,titleElement:b.querySelector(".navbox-title")||document.createElement("div")}).mount(b)})}catch(n){console.error("Failed to initialize NavLevel:",n),mw.notify("Failed to initialize NavLevel: "+n.message,{type:"error"})}}mw.hook("wikipage.content").add(ct)})();

  
});
